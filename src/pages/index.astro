---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection } from "astro:content";
import LatestPosts from "../components/LatestPosts.astro";
import FeaturedProjects from "../components/FeaturedProjects.astro";
import CategoryGrid from "../components/CategoryGrid.astro";

// 獲取所有文章
const allPosts = await getCollection("blog");

// 按日期排序
const sortedPosts = allPosts.sort((a, b) =>
    b.data.date.valueOf() - a.data.date.valueOf()
);

// 取得最新文章用於時間軸顯示
const latestPosts = sortedPosts;


// 為SEO準備關鍵字
const keywords = [
  "技術部落格", "軟體開發", "管理經驗", "閱讀心得", "個人成長", 
  "程式設計", "技術分享", ".NET開發", "Cloud Native", "系統架構",
  "容器化", "DevOps", "軟體工程", "技術管理", "後端開發"
];

// 增強的 SEO description
const enhancedDescription = `${SITE_DESCRIPTION} 涵蓋軟體開發、技術管理、系統架構設計等豐富內容，助您在技術職涯中持續成長。`;

// BreadcrumbList 結構化資料
const breadcrumbData = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "首頁",
      "item": Astro.url.toString()
    }
  ]
};

// 網站導航結構化資料
const siteNavigationData = {
  "@context": "https://schema.org",
  "@type": "SiteNavigationElement",
  "name": "主要導航",
  "url": [
    new URL("/software/", Astro.url).toString(),
    new URL("/management/", Astro.url).toString(),
    new URL("/reading/", Astro.url).toString(),
    new URL("/growth/", Astro.url).toString(),
    new URL("/archives/", Astro.url).toString(),
    new URL("/about/", Astro.url).toString()
  ]
};

// 增強的部落格結構化資料
const blogStructuredData = {
  "@context": "https://schema.org",
  "@type": "Blog",
  "headline": SITE_TITLE,
  "description": enhancedDescription,
  "url": Astro.url.toString(),
  "inLanguage": "zh-TW",
  "author": {
    "@type": "Person",
    "name": "Ean Lee",
    "description": "資深軟體開發者，專注於 .NET、Cloud Native 與系統架構設計",
    "url": Astro.url.toString(),
    "sameAs": [
      "https://github.com/EanLee"
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": "伊恩的開發狂想",
    "description": "技術部落格，分享軟體開發與技術管理經驗",
    "url": Astro.url.toString(),
    "logo": {
      "@type": "ImageObject",
      "url": new URL("/favicon.ico", Astro.url).toString(),
      "width": 60,
      "height": 60
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url.toString()
  },
};
---

<!doctype html>
<html lang="zh-TW" itemscope itemtype="https://schema.org/Blog">
<head>
    <BaseHead 
      title={SITE_TITLE} 
      description={enhancedDescription} 
      keywords={keywords}
    />
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .home-container {
            width: 100%;
            max-width: var(--container-xl);
            margin: 0 auto;
            padding: 0 var(--spacing-md);
            flex: 1;
        }

        .main-content {
            margin: var(--spacing-lg) 0 var(--spacing-2xl);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-2xl);
        }

        /* 優化非首屏內容渲染 */
        .below-fold {
            content-visibility: auto;
            contain-intrinsic-size: auto 500px;
        }

        @media (max-width: 768px) {
            .home-container {
                padding: 0 var(--spacing-sm);
            }

            .main-content {
                gap: var(--spacing-xl);
            }
        }
    </style>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json" set:html={JSON.stringify(blogStructuredData)} />
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbData)} />
    <script type="application/ld+json" set:html={JSON.stringify(siteNavigationData)} />
</head>
<body>
<Header />

<div class="home-container">
    <div class="main-content">
        <!-- Latest Articles -->
        <LatestPosts posts={latestPosts} limit={6} />

        <!-- Category Grid -->
        <CategoryGrid allPosts={allPosts} />

        <!-- Featured Projects - 延遲渲染 -->
        <div class="below-fold">
            <FeaturedProjects />
        </div>
    </div>
</div>

<Footer />
</body>
</html>
