<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext - ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7903108559996033" crossorigin=anonymous></script><meta name=description content="ç•¶ .NET Core è¦ä½¿ç”¨ EF Core å»å­˜å– PostgreSQL æ™‚ï¼Œå¯ä»¥å…ˆä½¿ç”¨ dotnet-ef çš„å·¥å…·ï¼Œå”åŠ©ç”¢ç”Ÿå°æ‡‰ PostgreSQL schema çš„ DBContext"><meta property="og:title" content="ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext"><meta property="og:description" content="ç•¶ .NET Core è¦ä½¿ç”¨ EF Core å»å­˜å– PostgreSQL æ™‚ï¼Œå¯ä»¥å…ˆä½¿ç”¨ dotnet-ef çš„å·¥å…·ï¼Œå”åŠ©ç”¢ç”Ÿå°æ‡‰ PostgreSQL schema çš„ DBContext"><meta property="og:type" content="article"><meta property="og:url" content="https://eandev.com/post/develop/dotnet-ef-postgresql-dbcontext/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-02-13T04:13:02+00:00"><meta property="article:modified_time" content="2023-03-02T02:49:47+00:00"><meta itemprop=name content="ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext"><meta itemprop=description content="ç•¶ .NET Core è¦ä½¿ç”¨ EF Core å»å­˜å– PostgreSQL æ™‚ï¼Œå¯ä»¥å…ˆä½¿ç”¨ dotnet-ef çš„å·¥å…·ï¼Œå”åŠ©ç”¢ç”Ÿå°æ‡‰ PostgreSQL schema çš„ DBContext"><meta itemprop=datePublished content="2023-02-13T04:13:02+00:00"><meta itemprop=dateModified content="2023-03-02T02:49:47+00:00"><meta itemprop=wordCount content="456"><meta itemprop=keywords content="EF Core,Postgresql,"><meta name=twitter:card content="summary"><meta name=twitter:title content="ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext"><meta name=twitter:description content="ç•¶ .NET Core è¦ä½¿ç”¨ EF Core å»å­˜å– PostgreSQL æ™‚ï¼Œå¯ä»¥å…ˆä½¿ç”¨ dotnet-ef çš„å·¥å…·ï¼Œå”åŠ©ç”¢ç”Ÿå°æ‡‰ PostgreSQL schema çš„ DBContext"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-4HXSCXTZKZ',{anonymize_ip:!1})}</script><link href=/css/syntax.min.css rel=stylesheet><link href=/css/copy-to-clipboard.min.css rel=stylesheet></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class="logo logo--mixed"><a class=logo__link href=/ title=ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³ rel=home><div class="logo__item logo__imagebox"><img class=logo__img alt=logo src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</div><div class=logo__tagline>åœ¨çŸ¥è­˜å¤§æµ·ä¸­æ¼‚æµçš„å°èˆ¹ï¼Œä¸åœè¿½å°‹å±¬æ–¼è‡ªå·±çš„ç§˜å¯¶ã€‚å°ˆæ³¨æ–¼ .NETã€é›²ç«¯æŠ€è¡“ã€ç³»çµ±æ¶æ§‹ã€é–‹ç™¼æŠ€å·§çš„é“ã€æ³•ã€è¡“ã€‚</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>ä¼Šæ©</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-02-13T04:13:02Z>2023-02-13</time>
<time class=meta__text datetime=2023-03-02T02:49:47Z>(Last Modified: 2023-03-02)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/ rel=category>è»Ÿé«”é–‹ç™¼</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#å‰ç½®ä½œæ¥­>å‰ç½®ä½œæ¥­</a><ul><li><a href=#å»ºç«‹-postgresql>å»ºç«‹ PostgreSQL</a></li><li><a href=#å»ºç«‹-net-core-lab-å°ˆæ¡ˆ>å»ºç«‹ .NET Core Lab å°ˆæ¡ˆ</a></li></ul></li><li><a href=#entity-framework-core-tools>Entity Framework Core Tools</a><ul><li><a href=#ef-tool-çš„å®‰è£èˆ‡æ›´æ–°>EF Tool çš„å®‰è£èˆ‡æ›´æ–°</a></li><li><a href=#ç”¢ç”Ÿ-dbcontext>ç”¢ç”Ÿ DBContext</a></li><li><a href=#ç•°å¸¸æ’é™¤>ç•°å¸¸æ’é™¤</a></li></ul></li><li><a href=#user-secrets>user-secrets</a></li><li><a href=#å»¶ä¼¸é–±è®€>å»¶ä¼¸é–±è®€</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>è‹¥æ˜¯æœ‰ä½¿ç”¨é Entity Framework, EF çš„ç¶“é©—ï¼Œå¿…ç„¶å° <code>DBContext</code> é¡åˆ¥æœ‰æ‰€äº†è§£ã€‚åœ¨ EF æ™‚å¯ä»¥ä½¿ç”¨ Visual Studo çš„ UI å·¥å…·ï¼Œä»¥ Database-First çš„æ–¹å¼å»ºç«‹ DBContextã€‚</p><p>æœ¬ç¯‡æ–‡ç« å‰‡æ˜¯è¨˜éŒ„ Database-First çš„é–‹ç™¼æ–¹å¼ä¸‹ï¼ŒEF Core å¦‚ä½•ä½¿ç”¨ CLI ä¾†ç”¢ç”Ÿ DBContextã€‚</p><blockquote><p>ğŸ”– é•·è©±çŸ­èªª ğŸ”–</p><ul><li>EF Core è¦æ“ä½œ PostgreSQL çš„è©±ï¼Œå¯ä½¿ç”¨ <code>Npgsql.EntityFrameworkCore.PostgreSQL</code></li><li>å¯ä½¿ç”¨ <code>dotnet tool update --global dotnet-ef</code> é€²è¡Œ <code>dotnet-ef</code> ç‰ˆæœ¬æ›´æ–°</li><li>å¯ä½¿ç”¨ <code>dotnet ef dbcontext scffold</code> çš„æŒ‡ä»¤ï¼Œå”åŠ©å¾è³‡æ–™åº«å·²å­˜åœ¨çš„ Schema ç”¢ç”Ÿå°æ‡‰çš„ dbcontextã€‚</li><li>è‹¥å°ˆæ¡ˆå…§æœªåƒè€ƒ <code>Microsoft.EntityFrameworkCore.Design</code> çš„è©±ï¼Œ<code>dotnet ef dbcontext scffold</code> ç„¡æ³•é †åˆ©å‹•ä½œã€‚</li><li>æ©Ÿæ•æ€§è³‡æ–™ï¼Œå¯ä½¿ç”¨ <code>user-secrets</code> å·¥å…·ã€‚</li></ul></blockquote><p>æ“ä½œç’°å¢ƒï¼š</p><ul><li>Windows 11</li><li>.NET Core 7</li><li>Postgresql 15.1</li></ul><h2 id=å‰ç½®ä½œæ¥­>å‰ç½®ä½œæ¥­</h2><h3 id=å»ºç«‹-postgresql>å»ºç«‹ PostgreSQL</h3><p>é¸æ“‡ä½¿ç”¨ Docker compose çš„æ–¹å¼ï¼Œä¾†å»ºç«‹ PostgreSQLã€‚</p><p>ä½¿ç”¨ä¸‹é¢çš„ yml è¨­å®šï¼Œé è¨­å„²å­˜ç‚º <code>docker-compose.yml</code> æª”ã€‚ç•¶ç„¶ä¹Ÿå¯ä»¥å­˜ç‚ºå…¶ä»–æ›´å…·è­˜åˆ¥æ€§çš„åç¨±ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.6&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:15.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRES_USER=postgres</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRES_PASSWORD=psg1234</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5432:5432&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres-data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres-data</span>:
</span></span></code></pre></div><p>è‹¥æ˜¯å­˜ç‚º <code>docker-compose.yml</code> æ™‚ï¼Œç›´æ¥åŸ·è¡Œä¸‹è¿°èªæ³•å³å¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p>è‹¥æ˜¯å­˜ç‚ºå…¶ä»–æª”åæ™‚ï¼Œéœ€è¦ä½¿ç”¨ <code>-f</code> æŒ‡å®š yml çš„æª”æ¡ˆã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker-compose -f &lt;docker-compose.yml&gt; up -d
</span></span></code></pre></div><p>æ¥è‘—å»ºç«‹ä¸€å€‹ç°¡å–®çš„è¡¨æ ¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> todo
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id    integer <span style=color:#66d9ef>generated</span> always <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>identity</span>,
</span></span><span style=display:flex><span>    title varchar(<span style=color:#ae81ff>30</span>)                         <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    date  <span style=color:#66d9ef>timestamp</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>current_timestamp</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=å»ºç«‹-net-core-lab-å°ˆæ¡ˆ>å»ºç«‹ .NET Core Lab å°ˆæ¡ˆ</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># å»ºç«‹æ–°çš„ console å°ˆæ¡ˆ</span>
</span></span><span style=display:flex><span>dotnet new webapi -n efcore_lab
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd efcore_lab
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£ Nuget å¥—ä»¶</span>
</span></span><span style=display:flex><span>dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL --version 7.0.1
</span></span><span style=display:flex><span>dotnet add package Microsoft.EntityFrameworkCore.Design
</span></span></code></pre></div><p><code>Npgsql.EntityFrameworkCore.PostgreSQL</code> æ˜¯ postgreSQL çš„ DB Providerã€‚</p><p>è‹¥æ˜¯æ²’æœ‰å®‰è£ <code>Microsoft.EntityFrameworkCore.Design</code>ï¼Œå¾ŒçºŒåŸ·è¡Œ <code>dotnet ef dbcontext scffold ...</code> çš„æŒ‡ä»¤æ™‚ï¼Œæœƒå‡ºç¾éŒ¯èª¤æç¤ºã€‚</p><p><figure><center><img src=images/uninstall-efcore-design-result.png alt="æœªå®‰è£ Microsoft.EntityFrameworkCore.Design çš„éŒ¯èª¤æç¤º"><figcaption>æœªå®‰è£ Microsoft.EntityFrameworkCore.Design çš„éŒ¯èª¤æç¤º</figcaption></center></figure></p><h2 id=entity-framework-core-tools>Entity Framework Core Tools</h2><h3 id=ef-tool-çš„å®‰è£èˆ‡æ›´æ–°>EF Tool çš„å®‰è£èˆ‡æ›´æ–°</h3><p>ä½¿ç”¨ EF Core Tools ä¹‹å‰ï¼Œéœ€å…ˆé€²è¡Œå®‰è£ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># å°‡ dotnet ef å®‰è£ç‚ºå…¨åŸŸå·¥å…·</span>
</span></span><span style=display:flex><span>dotnet tool install --global dotnet-ef
</span></span></code></pre></div><p>è‹¥æ›¾ç¶“å®‰è£é dotnet-ef çš„å·¥å…·ï¼Œä½†å¾ŒçºŒå°ˆæ¡ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ EF Coreï¼Œåœ¨åŸ·è¡Œ <code>dotnet ef</code> ç›¸é—œæŒ‡ä»¤æ™‚ï¼Œæœƒå‡ºç¾ä»¥ä¸‹çš„æç¤ºè¨Šæ¯ã€‚</p><p><code>The Entity Framework tools version '6.0.8' is older than that of the runtime '7.0.1'. Update the tools for the latest features and bug fixes. See https://aka.ms/AAc1fbw for more information.</code></p><p>ç•¶ç™¼ç”Ÿä¸Šè¿°çš„è¨Šæ¯æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æŒ‡ä»¤ä¾†æ›´æ–°æœ¬æ©Ÿå…§çš„ EF Core çš„ Tools å·¥å…·ç‰ˆæœ¬ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> dotnet tool update --global dotnet-ef
</span></span></code></pre></div><h3 id=ç”¢ç”Ÿ-dbcontext>ç”¢ç”Ÿ DBContext</h3><p>æ¥è‘—ï¼Œå°±è¦é‹ç”¨ <code>dotnet ef dbcontext scaffold</code> çš„æŒ‡ä»¤ï¼Œä¾†å”ä½œæˆ‘å€‘ç”¢ç”Ÿå°æ‡‰è³‡æ–™åº«çš„ DBContext äº†ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet ef dbcontext scaffold &lt;connection_string&gt; Npgsql.EntityFrameworkCore.PostgreSQL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¾‹å­</span>
</span></span><span style=display:flex><span>dotnet ef dbcontext scaffold <span style=color:#e6db74>&#34;Host=localhost;Database=postgres;Username=postgres;Password=psg1234;Trust Server Certificate=true&#34;</span> Npgsql.EntityFrameworkCore.PostgreSQL
</span></span></code></pre></div><p><figure><center><img src=images/success-dbcontext-scaffold.png alt="é †åˆ©æ›´æ–° DBContext"><figcaption>é †åˆ©æ›´æ–° DBContext</figcaption></center></figure></p><p>è‹¥æ˜¯æƒ³è¦æŒ‡å®šç”¢ç”Ÿå‡ºä¾†çš„ <code>&lt;DBContext.cs></code> æ”¾åˆ°æŒ‡å®šä½ç½®ï¼Œè¨˜å¾—é¡åŠ ä½¿ç”¨ <code>-o &lt;Path></code> çš„æŒ‡ä»¤ã€‚å¦å‰‡ç”¢ç”Ÿå‡ºä¾†çš„ä½ç½®èˆ‡ .csproj çš„ä½ç½®ç›¸åŒã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># æŒ‡å®š DBContext è¼¸å‡ºä½ç½®ç‚º Models è³‡æ–™å¤¾</span>
</span></span><span style=display:flex><span>dotnet ef dbcontext scaffold &lt;connection_string&gt; Npgsql.EntityFrameworkCore.PostgreSQL -o Models
</span></span></code></pre></div><h3 id=ç•°å¸¸æ’é™¤>ç•°å¸¸æ’é™¤</h3><h4 id=ç‹€æ³ä¸€è³‡æ–™åº«ä¸å­˜åœ¨>ç‹€æ³ä¸€ã€è³‡æ–™åº«ä¸å­˜åœ¨</h4><p>è‹¥æ˜¯é€£ç·šå­—ä¸²å…§çš„ <code>Database</code> åç¨±èˆ‡å¯¦éš›è³‡æ–™åº«åç¨±å¤§å°å¯«ä¸åŒï¼Œæœƒç™¼ç”Ÿæ‰¾ä¸åˆ°è³‡æ–™åº«çš„éŒ¯èª¤ã€‚è¦ç‰¹åˆ¥æ³¨æ„ã€‚</p><p>åœ¨é€™é‚Šï¼Œåˆ»æ„å°‡é€£ç·šå­—ä¸²å…§çš„ Database åç¨±ï¼Œç”± <code>postgres</code> æ”¹ç‚º <code>Postgres</code>ï¼Œæœƒçœ‹åˆ°ä¸‹è¿°çš„éŒ¯èª¤è¨Šæ¯ã€‚</p><p><figure><center><img src=images/failed-dbcontext-scffold-dbname-differice.png alt=è³‡æ–™åº«åç¨±å¤§å°å¯«ä¸åŒï¼Œå›æ‡‰è³‡æ–™åº«ä¸å­˜åœ¨><figcaption>è³‡æ–™åº«åç¨±å¤§å°å¯«ä¸åŒï¼Œå›æ‡‰è³‡æ–™åº«ä¸å­˜åœ¨</figcaption></center></figure></p><h4 id=ç‹€æ³äºŒå·²å­˜åœ¨æª”æ¡ˆ>ç‹€æ³äºŒã€å·²å­˜åœ¨æª”æ¡ˆ</h4><p>è‹¥å…ˆå‰å·²ç¶“æœ‰ç”¢ç”Ÿé <code>&lt;DBContext></code> ç›¸é—œæª”æ¡ˆï¼Œç›´æ¥åŸ·è¡ŒæŒ‡ä»¤æœƒå‡ºç¾ <code>The following file(s) already exist in directory 'c:\Codes\lab\efcore_lab\': PostgresContext.cs,Todo.cs. Use the Force flag to overwrite these files.</code> éŒ¯èª¤è¨Šæ¯ã€‚</p><p><figure><center><img src=images/failed-overwrite.png alt=å·²å­˜åœ¨è³‡æ–™ï¼Œéœ€æŒ‡å®šè¦†å¯«åŸæœ‰è³‡æ–™><figcaption>å·²å­˜åœ¨è³‡æ–™ï¼Œéœ€æŒ‡å®šè¦†å¯«åŸæœ‰è³‡æ–™</figcaption></center></figure></p><p>æ‰€ä»¥å¿…é ˆåœ¨æŒ‡ä»¤åŠ ä¸Š <code>-f</code>ï¼Œå‘ŠçŸ¥ <code>ef dbcontext scaffold</code> è¦è¦†å¯«å…ˆå‰å·²å­˜åœ¨çš„æª”æ¡ˆã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet ef dbcontext scaffold &lt;connection_string&gt; Npgsql.EntityFrameworkCore.PostgreSQL -o Models -f
</span></span></code></pre></div><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°çš„æŒ‡ä»¤æ‰€ç”¢ç”Ÿå‡ºä¾† DBContext.cs å…§ï¼Œæœƒå«æœ‰é€£ç·šå­—ä¸²ï¼Œç‚ºäº†é¿å…è³‡è¨Šå¤–æ´©ï¼Œå‹™å¿…è¨˜å¾—ç§»é™¤ï¼Œæ”¹ç”¨ configuration æ³¨å…¥çš„æ–¹å¼ã€‚</p><p><figure><center><img src=images/postgres-dbcontext.png alt="dotnet ef ç”¢ç”Ÿå‡ºä¾†çš„ PostgresContext å…§å®¹"><figcaption>dotnet ef ç”¢ç”Ÿå‡ºä¾†çš„ PostgresContext å…§å®¹</figcaption></center></figure></p><h2 id=user-secrets>user-secrets</h2><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ user-secrets çš„æ–¹å¼ï¼Œä¾†ç®¡ç†æ©Ÿæ•è³‡æ–™ï¼Œé¿å…é€£ç·šå­—ä¸²ç›´æ¥è¨˜éŒ„åœ¨ç¨‹å¼ç¢¼ä¹‹ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># å¾…èª¿æ•´ç‚º Postgresql çš„æ–¹å¼</span>
</span></span><span style=display:flex><span>dotnet user-secrets init
</span></span><span style=display:flex><span>dotnet user-secrets set ConnectionStrings:lab &lt;connection_string&gt;
</span></span><span style=display:flex><span>dotnet ef dbcontext scaffold Name<span style=color:#f92672>=</span>ConnectionStrings:lab Npgsql.EntityFrameworkCore.PostgreSQL
</span></span></code></pre></div><p>ç•¶ <code>user-serets init</code> åˆå§‹åŒ–ä¹‹å¾Œï¼Œæœƒç”¢ç”Ÿä¸€çµ„ <code>UserSecretsId</code>ï¼Œä¸¦å­˜åœ¨ .csproj ä¹‹ä¸­ã€‚</p><p><figure><center><img src=images/user-secrets-init.png alt="user-secrets init"><figcaption>user-secrets init</figcaption></center></figure></p><p><figure><center><img src=images/csproj-content.png alt="csproj å°ˆæ¡ˆæª”å…§çš„ UserSecretsId"><figcaption>csproj å°ˆæ¡ˆæª”å…§çš„ UserSecretsId</figcaption></center></figure></p><p>ä½¿ç”¨ <code>user-secrets set</code> å¾Œï¼Œç³»çµ±æœƒæŠŠæ©Ÿæ•è³‡æ–™å­˜æ”¾åˆ° <code>C:\Users\&lt;user>\AppData\Roaming\Microsoft\UserSecrets\&lt;UserSecretsId>\secrets.json</code> ä¹‹ä¸­ã€‚</p><p><figure><center><img src=images/user-secrets-setting-connectionstring.png alt="ä½¿ç”¨ user-secrets è¨­å®šé€£ç·šå­—ä¸²"><figcaption>ä½¿ç”¨ user-secrets è¨­å®šé€£ç·šå­—ä¸²</figcaption></center></figure><figure><center><img src=images/secrets-json-content.png alt="secrets.json å…§çš„è³‡æ–™"><figcaption>secrets.json å…§çš„è³‡æ–™</figcaption></center></figure></p><p>æœ€å¾Œä½¿ç”¨ <code>dotnet ef dbcontext scaffold</code> ä½¿ç”¨ <code>user-secrets</code> å…§çš„é€£ç·šå­—ä¸²ä¾†ç”¢ç”Ÿ DBContextã€‚å¯ä»¥ç™¼ç¾é€£ç·šå­—ä¸²ä¸æœƒè¢«è¨˜éŒ„åœ¨ DBContext ä¹‹ä¸­ã€‚</p><p><figure><center><img src=images/dbcontext-scaffold-user-secrets.png alt="ä½¿ç”¨ user-secrets å…§çš„é€£ç·šå­—ä¸²"><figcaption>ä½¿ç”¨ user-secrets å…§çš„é€£ç·šå­—ä¸²</figcaption></center></figure><figure><center><img src=images/postregs-dbcontext-context-user-secrets.png alt="ä½¿ç”¨ user-secrets ç”¢ç”Ÿå‡ºä¾†çš„ PostgresContext"><figcaption>ä½¿ç”¨ user-secrets ç”¢ç”Ÿå‡ºä¾†çš„ PostgresContext</figcaption></center></figure></p><h2 id=å»¶ä¼¸é–±è®€>å»¶ä¼¸é–±è®€</h2><ul><li><a href=https://www.npgsql.org/efcore/>Npgsql Entity Framework Core Provider | Npgsql Documentation</a></li><li><a href=https://learn.microsoft.com/zh-tw/ef/core/cli/>Entity Framework Core å·¥å…·åƒè€ƒ - EF Core | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/zh-tw/aspnet/core/security/app-secrets?view=aspnetcore-7.0&tabs=windows#enable-secret-storage">åœ¨é–‹ç™¼ä¸­å®‰å…¨å„²å­˜æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ï¼ŒASP.NET Core | Microsoft Learn</a></li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><a class=tag href=/tags/ef-core/ rel=tag>EF Core</a>
<a class=tag href=/tags/postgresql/ rel=tag>Postgresql</a></ul></div></footer><hr><div><p>æ–‡ç« å…§å®¹å‡ç‚ºå€‹äººå­¸ç¿’è¨˜éŒ„ã€å¿ƒå¾—èˆ‡èªçŸ¥ï¼Œè‹¥ä»»ä½•è¬¬èª¤æˆ–å»ºè­°ï¼Œæ­¡è¿ç›´æ¥ç•™è¨€è¨è«–ï¼Œä¸€åŒæˆé•·ã€‚</p></div><iframe class=LikeCoin src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feandev.com%2fpost%2fdevelop%2fdotnet-ef-postgresql-dbcontext%2f" height=200 width=100% frameborder=0></iframe>
<script src=/js/copy-code-clipboard.min.js></script></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/security/using-iis-create-and-complete-csr/ rel=prev><span class=pager__subtitle>Â«&#8201;Previous</span><p class=pager__title>ä½¿ç”¨ IIS é€²è¡Œ SSL æ†‘è­‰çš„ç”³è«‹èˆ‡æ›´æ–°çš„æ­¥é©Ÿèˆ‡æ³¨æ„äº‹é …</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/develop/dotnet-ef-sqlserver/ rel=next><span class=pager__subtitle>Next&#8201;Â»</span><p class=pager__title>ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var t=document,e=t.createElement('script');e.async=!0,e.src='//eanblog.disqus.com/embed.js',e.setAttribute('data-timestamp',+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 ä¼Šæ©è»Ÿé«”æŠ€è¡“å­¸ç¿’èˆ‡åˆ†äº«.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div></body></html>