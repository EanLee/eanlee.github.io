<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext - ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7903108559996033" crossorigin=anonymous></script><meta name=description content="å»ºç«‹ SQL Server on Docker æ™‚ï¼Œæœ‰ä¸€äº›æŒä¹…æ€§çš„è­°é¡Œå¿…é ˆç‰¹åˆ¥æ³¨æ„ã€‚åŒæ™‚ï¼Œä½¿ç”¨ EF Core é€£æ¥ SQL Server æ™‚ï¼Œé€£ç·šå­—ä¸²è¨­å®šä¸ç•¶ï¼Œä¹Ÿæœƒé€ æˆé€£ç·šå¤±æ•—ã€‚"><meta property="og:title" content="ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext"><meta property="og:description" content="å»ºç«‹ SQL Server on Docker æ™‚ï¼Œæœ‰ä¸€äº›æŒä¹…æ€§çš„è­°é¡Œå¿…é ˆç‰¹åˆ¥æ³¨æ„ã€‚åŒæ™‚ï¼Œä½¿ç”¨ EF Core é€£æ¥ SQL Server æ™‚ï¼Œé€£ç·šå­—ä¸²è¨­å®šä¸ç•¶ï¼Œä¹Ÿæœƒé€ æˆé€£ç·šå¤±æ•—ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://eandev.com/post/develop/dotnet-ef-sqlserver/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-02-14T10:12:33+00:00"><meta property="article:modified_time" content="2023-03-02T02:49:47+00:00"><meta itemprop=name content="ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext"><meta itemprop=description content="å»ºç«‹ SQL Server on Docker æ™‚ï¼Œæœ‰ä¸€äº›æŒä¹…æ€§çš„è­°é¡Œå¿…é ˆç‰¹åˆ¥æ³¨æ„ã€‚åŒæ™‚ï¼Œä½¿ç”¨ EF Core é€£æ¥ SQL Server æ™‚ï¼Œé€£ç·šå­—ä¸²è¨­å®šä¸ç•¶ï¼Œä¹Ÿæœƒé€ æˆé€£ç·šå¤±æ•—ã€‚"><meta itemprop=datePublished content="2023-02-14T10:12:33+00:00"><meta itemprop=dateModified content="2023-03-02T02:49:47+00:00"><meta itemprop=wordCount content="539"><meta itemprop=keywords content="EF Core,SQL Server,Docker,"><meta name=twitter:card content="summary"><meta name=twitter:title content="ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext"><meta name=twitter:description content="å»ºç«‹ SQL Server on Docker æ™‚ï¼Œæœ‰ä¸€äº›æŒä¹…æ€§çš„è­°é¡Œå¿…é ˆç‰¹åˆ¥æ³¨æ„ã€‚åŒæ™‚ï¼Œä½¿ç”¨ EF Core é€£æ¥ SQL Server æ™‚ï¼Œé€£ç·šå­—ä¸²è¨­å®šä¸ç•¶ï¼Œä¹Ÿæœƒé€ æˆé€£ç·šå¤±æ•—ã€‚"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-4HXSCXTZKZ',{anonymize_ip:!1})}</script><link href=/css/syntax.min.css rel=stylesheet><link href=/css/copy-to-clipboard.min.css rel=stylesheet></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class="logo logo--mixed"><a class=logo__link href=/ title=ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³ rel=home><div class="logo__item logo__imagebox"><img class=logo__img alt=logo src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</div><div class=logo__tagline>åœ¨çŸ¥è­˜å¤§æµ·ä¸­æ¼‚æµçš„å°èˆ¹ï¼Œä¸åœè¿½å°‹å±¬æ–¼è‡ªå·±çš„ç§˜å¯¶ã€‚å°ˆæ³¨æ–¼ .NETã€é›²ç«¯æŠ€è¡“ã€ç³»çµ±æ¶æ§‹ã€é–‹ç™¼æŠ€å·§çš„é“ã€æ³•ã€è¡“ã€‚</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>ä¼Šæ©</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-02-14T10:12:33Z>2023-02-14</time>
<time class=meta__text datetime=2023-03-02T02:49:47Z>(Last Modified: 2023-03-02)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/ rel=category>è»Ÿé«”é–‹ç™¼</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#ä½¿ç”¨-docker-å»ºç«‹-sql-server>ä½¿ç”¨ Docker å»ºç«‹ SQL Server</a><ul><li><a href=#è³‡æ–™çš„æŒä¹…æ€§>è³‡æ–™çš„æŒä¹…æ€§</a></li><li><a href=#è³‡æ–™çš„å‚™ä»½èˆ‡é‚„åŸ>è³‡æ–™çš„å‚™ä»½èˆ‡é‚„åŸ</a></li></ul></li><li><a href=#ä½¿ç”¨-dotnet-ef-å»ºç«‹-dbcontext>ä½¿ç”¨ dotnet-ef å»ºç«‹ DBContext</a><ul><li><a href=#å¥—ä»¶èˆ‡æŒ‡ä»¤>å¥—ä»¶èˆ‡æŒ‡ä»¤</a></li><li><a href=#éŒ¯èª¤æ’é™¤>éŒ¯èª¤æ’é™¤</a></li></ul></li><li><a href=#å»¶ä¼¸é–±è®€>å»¶ä¼¸é–±è®€</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>åœ¨ <a href=https://eandev.com/post/develop/dotnet-ef-postgresql-dbcontext/>ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext</a> ä¹‹å¾Œï¼Œä¹Ÿå˜—è©¦å¾ SQL Server on Docker å»ºç«‹ DBContextï¼Œå°±é †æ‰‹æŠŠéç¨‹ä¸­é‡åˆ°çš„å°å•é¡Œè¨˜éŒ„ä¸‹ä¾†ã€‚</p><blockquote><p>ğŸ”– é•·è©±çŸ­èªª ğŸ”–</p><ul><li>ä½¿ç”¨ Docker å»ºç«‹çš„ SQL Serverï¼Œè‹¥éœ€è¦é€²è¡Œ bak çš„å‚™ä»½èˆ‡é‚„åŸæ™‚ï¼Œåœ¨åŸ·è¡Œ Container æ™‚ï¼Œåˆ¥å¿˜äº† mount è³‡æ–™å¤¾ã€‚</li><li>ä½¿ç”¨ <code>dotnet ef dbcontext scaffold</code> æ™‚ï¼Œç™¼ç”Ÿ <code>æ­¤æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½ç™¼å‡ºçš„</code> çš„å·®ç•°ï¼Œè«‹åœ¨é€£ç·šå­—ä¸²å…§åŠ å…¥ <code>TrustServerCertificate=true</code>ã€‚</li><li>ä½¿ç”¨ <code>dotnet ef dbcontext scaffold</code> æ™‚ï¼Œç™¼ç”Ÿ <code>Login failed for user</code> çš„åç¨±èˆ‡é€£ç·šå­—ä¸²å…§çš„ <code>User Id</code> ä¸åŒæ™‚ï¼Œè«‹ç¢ºèªé€£ç·šå­—ä¸²å…§çš„ <code>Trusted_Connection</code> ã€‚</li></ul></blockquote><p>æ“ä½œç’°å¢ƒï¼š</p><ul><li>Windows 11</li><li>.NET Core 7</li><li>EF Core 7</li><li>SQL Server 2022</li></ul><h2 id=ä½¿ç”¨-docker-å»ºç«‹-sql-server>ä½¿ç”¨ Docker å»ºç«‹ SQL Server</h2><p>å¾å¾®è»Ÿ <a href=https://www.microsoft.com/en-us/sql-server/sql-server-downloads>SQL Server ä¸‹è¼‰é </a>å…§ï¼Œæä¾›å¤šç¨® SQL Server çš„ç‰ˆæœ¬ï¼Œç‚ºäº†æ–¹ä¾¿ï¼Œé¸æ“‡ä½¿ç”¨ Docker containerã€‚</p><p>ç¶²ç«™ä¸Šæä¾›äº† <code>Windows container on Docker</code> èˆ‡ <code>Linux container on Docker</code> å…©ç¨®é¸é …ï¼Œä½†æœ€å¾Œéƒ½æœƒæŒ‡å‘åŒä¸€å€‹ DockerHub <a href=https://hub.docker.com/_/microsoft-mssql-server>Microsoft SQL Server - Ubuntu based images</a>ã€‚</p><p>æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä¸‹è¿°çš„æŒ‡ä»¤ä¾†å•Ÿå‹• SQL Server çš„ Containerã€‚</p><p>åœ¨ç¯„ä¾‹ä¸­ï¼Œå°‡ <code>MSSQL_SA_PASSWORD</code> è¨­ç‚º <code>AZ@xsw2ec</code>ï¼Œä½†å¯¦éš›é‹ç”¨ä¸Šï¼Œåˆ¥å¿˜äº†ä¿®æ”¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -e <span style=color:#e6db74>&#34;ACCEPT_EULA=Y&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -e <span style=color:#e6db74>&#34;MSSQL_SA_PASSWORD=AZ@xsw2ec&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -p 1433:1433 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   --name sql1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   mcr.microsoft.com/mssql/server:2022-latest
</span></span></code></pre></div><p>é—œæ–¼ SQL Server ç’°å¢ƒåƒæ•¸èªªæ˜</p><ul><li><code>ACCEPT_EULA</code>: ç¢ºèªæ˜¯å¦åŒæ„ <a href="https://go.microsoft.com/fwlink/?linkid=857698">End-User Licensing Agreement</a></li><li><code>MSSQL_SA_PASSWORD</code>: sa å¸³æˆ¶çš„å¯†ç¢¼ï¼Œéœ€è¶…é 8 å€‹å­—å…ƒï¼ŒåŒæ™‚ï¼Œè‡³å°‘åŒ…å«å¤§å¯«ã€å°å¯«ã€æ•¸å­—èˆ‡éå­—æ¯çš„ç¬¦è™Ÿï¼Œå…¶ä¸­ä¸‰ç¨®ã€‚</li></ul><h3 id=è³‡æ–™çš„æŒä¹…æ€§>è³‡æ–™çš„æŒä¹…æ€§</h3><p>æˆ‘å€‘éƒ½çŸ¥é“ Container åˆªé™¤çš„åŒæ™‚ï¼ŒContainer å…§æ‰€æœ‰çš„è³‡æ–™éƒ½æœƒè·Ÿè‘—åˆªé™¤ã€‚è€Œè³‡æ–™åº«çš„è³‡æ–™åˆæ˜¯æœ€é‡è¦çš„éƒ¨ä»½ã€‚</p><p>ç‚ºç¢ºä¿è³‡æ–™çš„æŒä¹…æ€§ï¼Œå¯ä»¥å¾ <code>Bind Mount</code> æˆ– <code>Volume</code> å…©ç¨®ä½œæ³•æ“‡ä¸€æ¡ç”¨ã€‚</p><h4 id=bind-mount-æ›è¼‰å¯¦é«”çš„æª”æ¡ˆç³»çµ±>Bind Mount: æ›è¼‰å¯¦é«”çš„æª”æ¡ˆç³»çµ±</h4><p>Bind Mount çš„åƒæ•¸å¯ä½¿ç”¨ <code>-v</code> æˆ– <code>--mount</code> ï¼Œè‹¥ä½¿ç”¨ <code>--mount</code> éœ€æ˜ç¢ºæŒ‡å®š type ç‚º <code>bind</code>ã€<code>volume</code> æˆ– <code>tmpfs</code> å…¶ä¸­ä¸€ç¨®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -e <span style=color:#e6db74>&#34;ACCEPT_EULA=Y&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -e <span style=color:#e6db74>&#34;MSSQL_SA_PASSWORD=AZ@xsw2ec&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -p 1433:1433 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v &lt;host directory&gt;/data:/var/opt/mssql/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v &lt;host directory&gt;/log:/var/opt/mssql/log <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v &lt;host directory&gt;/secrets:/var/opt/mssql/secrets <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   mcr.microsoft.com/mssql/server:2019-latest
</span></span></code></pre></div><p><code>&lt;host directory></code> ç‚º Host çš„è³‡æ–™å¤¾è·¯å¾‘ã€‚</p><p>è‹¥ä»¥ windows ç‚ºä¾‹ï¼ŒæŒ‡å®š <code>host directory</code> ç‚º <code>C:\docker_mount</code>ï¼ŒæŒ‡ä»¤èª¿æ•´å¦‚ä¸‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -e <span style=color:#e6db74>&#34;ACCEPT_EULA=Y&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -e <span style=color:#e6db74>&#34;MSSQL_SA_PASSWORD=AZ@xsw2ec&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -p 1433:1433 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v C:<span style=color:#ae81ff>\d</span>ocker_mount/data:/var/opt/mssql/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v C:<span style=color:#ae81ff>\d</span>ocker_mount/log:/var/opt/mssql/log <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v C:<span style=color:#ae81ff>\d</span>ocker_mount/secrets:/var/opt/mssql/secrets <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   mcr.microsoft.com/mssql/server:2019-latest
</span></span></code></pre></div><h5 id=volume-ä½¿ç”¨-docker-å®Œå…¨ç®¡ç†è³‡æ–™>Volume: ä½¿ç”¨ Docker å®Œå…¨ç®¡ç†è³‡æ–™</h5><p>Volume çš„åƒæ•¸ç‚º <code>-v</code>ã€‚è‹¥åœ¨ <code>docker run</code> ä¹‹ä¸­ä½¿ç”¨æœªå®šç¾©æˆ–ä¸å­˜åœ¨çš„ volumeï¼Œdocker æœƒè‡ªå‹•ç”¢ç”Ÿæ–°çš„ volumeï¼Œä»¥æä¾› container ä½¿ç”¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -e <span style=color:#e6db74>&#34;ACCEPT_EULA=Y&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -e <span style=color:#e6db74>&#34;MSSQL_SA_PASSWORD=AZ@xsw2ec&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -p 1433:1433 
</span></span><span style=display:flex><span>		   -v sqlvolume:/var/opt/mssql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   mcr.microsoft.com/mssql/server:2019-latest
</span></span></code></pre></div><h3 id=è³‡æ–™çš„å‚™ä»½èˆ‡é‚„åŸ>è³‡æ–™çš„å‚™ä»½èˆ‡é‚„åŸ</h3><p>è‹¥æ˜¯æƒ³è¦ä½¿ç”¨ SSMS å°‡ <code>.bak</code> é€²è¡Œé‚„åŸï¼Œæˆ–æ˜¯é€²è¡Œå‚™ä»½æ™‚ï¼Œè‹¥æ˜¯å»ºç«‹ contaier æ™‚æ²’æœ‰ <code>mount</code> å¯¦é«”ä½ç½®æ™‚ï¼Œå°±æœƒç™¼ç”Ÿæ‰¾ä¸åˆ°è¦é‚„åŸçš„ <code>.bak</code> æª”æ¡ˆã€‚</p><p><figure><center><img src=images/smss-sql-server-on-docker.png alt="SMSS å¾é€²è¡Œè³‡æ–™åº«é‚„åŸä½œæ¥­"><figcaption>SMSS å¾é€²è¡Œè³‡æ–™åº«é‚„åŸä½œæ¥­</figcaption></center></figure>æ‰€ä»¥ï¼Œè‹¥æ˜¯æœ‰å‚™ä»½æˆ–é‚„åŸ <code>.bak</code> çš„éœ€æ±‚ï¼Œåˆ¥å¿˜äº†mount çš„å‹•ä½œã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -e <span style=color:#e6db74>&#34;ACCEPT_EULA=Y&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -e <span style=color:#e6db74>&#34;MSSQL_SA_PASSWORD=AZ@xsw2ec&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -p 1433:1433 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   --name sql1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   -v C:<span style=color:#ae81ff>\d</span>ocker_mount:/sql_data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		   mcr.microsoft.com/mssql/server:2022-latest
</span></span></code></pre></div><h2 id=ä½¿ç”¨-dotnet-ef-å»ºç«‹-dbcontext>ä½¿ç”¨ dotnet-ef å»ºç«‹ DBContext</h2><h3 id=å¥—ä»¶èˆ‡æŒ‡ä»¤>å¥—ä»¶èˆ‡æŒ‡ä»¤</h3><p>åœ¨ä½¿ç”¨ dotnet-ef ä¹‹å‰ï¼Œåˆ¥å¿˜äº†å…ˆç‚ºå°ˆæ¡ˆå¢åŠ ä»¥ä¸‹å…©å€‹å¥—ä»¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet add package Microsoft.EntityFrameworkCore.Design
</span></span><span style=display:flex><span>dotnet add package Microsoft.EntityFrameworkCore.SqlServer
</span></span></code></pre></div><p>æ¥è‘—ï¼Œè¨­å®šå¥½ SQL Server çš„é€£ç·šå­—ä¸²å¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>dotnet-ef</code> ä¾†å»ºç«‹ DBContextã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet ef dbcontext scaffold <span style=color:#e6db74>&#34;Server=localhost;Database=Lab;User Id=sa;Password=AZ@xsw2ec;TrustServerCertificate=true;&#34;</span> Microsoft.EntityFrameworkCore.SqlServer -o Models
</span></span></code></pre></div><p>é€£ç·šå­—ä¸²åƒæ•¸èªªæ˜</p><ul><li><code>Server</code>: è³‡æ–™åº«æ‰€åœ¨çš„ä¸»æ©Ÿä½ç½®</li><li><code>Database</code>: è³‡æ–™åº«åç¨±</li><li><code>TrustServerCertificate</code>: å¼·åˆ¶ç”¨æˆ¶ç«¯ä¿¡ä»»æ†‘è­‰è€Œä¸é€²è¡Œé©—è­‰ã€‚</li></ul><p>è‹¥æ˜¯åªæƒ³è¦ <code>æ›´æ–°/å»ºç«‹</code> ç‰¹å®šçš„è¡¨æ ¼çš„ DBContextï¼Œå¯åœ¨æŒ‡ä»¤å¾Œæ–¹åŠ ä¸Š <code>-t</code> æˆ– <code>--table</code> çš„æ–¹å¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet ef dbcontext scaffold <span style=color:#e6db74>&#34;Server=localhost;Database=Lab;User Id=sa;Password=AZ@xsw2ec;TrustServerCertificate=true;&#34;</span> Microsoft.EntityFrameworkCore.SqlServer -o Models -t table1 -t table2
</span></span></code></pre></div><h3 id=éŒ¯èª¤æ’é™¤>éŒ¯èª¤æ’é™¤</h3><h4 id=-æ­¤æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½ç™¼å‡º>âš  æ­¤æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½ç™¼å‡º</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Server=localhost;Database=Lab;User Id=sa;Password=!QAZxsw23edc;Trusted_Connection=True;
</span></span></code></pre></div><p>ç•¶ä½¿ç”¨ç›´æ¥ä½¿ç”¨ä¸Šè¿°çš„é€£ç·šå­—ä¸²æ™‚ï¼Œæœƒç™¼ç”Ÿ SqlException: <code>A connection was successfully established with the server, but then an error occurred during the login process. (provider: SSL Provider, error: 0 - æ­¤æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½ç™¼å‡ºçš„ã€‚)</code>ã€‚</p><p><figure><center><img src=images/error-during-login-process.png alt=æ­¤æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½ç™¼å‡ºçš„><figcaption>æ­¤æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½ç™¼å‡ºçš„</figcaption></center></figure></p><p>ç•¶ä½¿ç”¨çš„ <code>Microsoft ODBC Driver for SQL Server</code> å‡ç´šåˆ° 18 ä¹‹å¾Œï¼ŒDriver <strong>é è¨­é–‹å•Ÿè³‡æ–™åŠ å¯†</strong>ã€‚</p><p>ç•¶è³‡æ–™åŠ å¯†é–‹å•Ÿæ™‚ï¼ŒDriver æœƒé€²è¡Œä¼ºæœå™¨æ†‘è­‰çš„é©—è­‰ï¼Œä½† SQL Server é è¨­ä½¿ç”¨çš„ TLS æ†‘è­‰ç‚ºè‡ªç°½æ†‘è­‰ (Self-Signed Certificate)ï¼Œè€Œç”¨æˆ¶ç«¯ä¸æœƒæœ‰é€™å€‹æ†‘è­‰ã€‚å› æ­¤å‡ºç¾é©—è­‰ä¸é€šéçš„ç•°å¸¸ã€‚</p><p>éœ€è¦åœ¨é€£ç·šå­—ä¸²åŠ å…¥ <code>TrustServerCertificate=true;</code>ã€‚</p><h4 id=-login-failed-for-user-xxxxxxxguest>âš  Login failed for user &lsquo;xxxxxxx\Guest&rsquo;</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Server=localhost;Database=Lab;User Id=sa;Password=!QAZxsw23edc;Trusted_Connection=True;TrustServerCertificate=true;
</span></span></code></pre></div><p>ç•¶ä½¿ç”¨å«æœ‰ <code>Trusted_Connection=True</code> çš„é€£ç·šå­—ä¸²æ™‚ï¼Œæœƒç™¼ç”Ÿ SqlException: <code>Login failed for user 'ce0e359b2caa\Guest'</code>ã€‚</p><p>é€™æ™‚ï¼Œå¯èƒ½æœƒå¾ˆå¥‡æ€ªï¼Œæ˜æ˜é€£ç·šå­—ä¸²å…§çš„ <code>User Id=sa</code> ï¼Œä½†ç‚ºä»€éº¼ç™»å…¥çš„ä½¿ç”¨è€…èˆ‡å‚³å…¥çš„å¸³è™Ÿä¸åŒï¼Ÿ</p><p>ç•¶ <code>Trusted_Connection=Ture</code> æ™‚ï¼ŒSQL Server ç‚ºç¢ºä¿æ˜¯å¯ä¿¡ä»»çš„é€£ç·šï¼Œæœƒä½¿ç”¨ <code>Windows é©—è­‰</code> çš„æ–¹å¼ç™»å…¥ï¼Œè‹¥æ‰¾ä¸åˆ°å°æ‡‰çš„å¸³è™Ÿï¼Œé è¨­ä½¿ç”¨ <code>Guest</code> å¸³è™Ÿã€‚</p><p><figure><center><img src=images/login-failed-for-user.png alt="Login failed for user"><figcaption>Login failed for user</figcaption></center></figure></p><h2 id=å»¶ä¼¸é–±è®€>å»¶ä¼¸é–±è®€</h2><p>â–¶ ç«™å…§æ–‡ç« </p><ul><li><a href=https://eandev.com/post/series/build-automated-deploy/docker-operate/>Docker æ“ä½œç°¡ä»‹</a></li><li><a href=https://eandev.com/post/develop/dotnet-ef-postgresql-dbcontext/>ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext</a></li></ul><p>â–¶ å¤–éƒ¨æ–‡ç« </p><ul><li><a href="https://learn.microsoft.com/zh-tw/troubleshoot/sql/database-engine/connect/certificate-chain-not-trusted?source=recommendations&tabs=ole-db-driver-19">æ†‘è­‰éˆçµæ˜¯ç”±ä¸å—ä¿¡ä»»çš„æˆæ¬Šå–®ä½æ‰€ç™¼è¡Œ - SQL Server | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/zh-tw/sql/linux/sql-server-linux-docker-container-configure?view=sql-server-ver16&pivots=cs1-bash">è¨­å®šå’Œè‡ªè¨‚ SQL Server Docker å®¹å™¨ - SQL Server | Microsoft Learn</a></li><li><a href=https://blog.miniasp.com/post/2020/08/04/Docker-SQL-Server-on-Linux>ä½¿ç”¨ Docker åŸ·è¡Œ SQL Server on Linux å®¹å™¨ä¹‹å¸¸ç”¨å·¥å…·èˆ‡å‘½ä»¤ | The Will Will Web (miniasp.com)</a></li><li><a href=https://learn.microsoft.com/zh-tw/dotnet/framework/data/adonet/connection-string-syntax>é€£æ¥å­—ä¸²èªæ³• - ADO.NET | Microsoft Learn</a></li><li><a href=https://www.twilio.com/blog/containerize-your-sql-server-with-docker-and-aspnet-core-with-ef-core>Dockerize your SQL Server and use it in ASP.NET Core with Entity Framework Core (twilio.com)</a></li><li><a href=https://blog.darkthread.net/blog/view-sql-encrypt-certificate/>SQL é€£ç·šåŠ å¯†è§€å¯ŸåŠåŠ å¯†æ†‘è­‰æª¢æŸ¥ - é»‘æš—åŸ·è¡Œç·’ (darkthread.net)</a></li><li><a href=https://nodogmablog.bryanhogan.net/2021/08/using-entity-framework-for-net-6-with-sql-server-in-a-docker-container/>Using Entity Framework for .NET 6 with SQL Server in a Docker Container | no dogma blog (bryanhogan.net)</a></li><li><a href=https://blog.poychang.net/the-certificate-chain-was-issued-by-an-authority-that-is-not-trusted/>ä½¿ç”¨ Microsoft.Data.SqlClient é€£ç·šè³‡æ–™åº«ç™¼ç”Ÿæ†‘è­‰éŒ¯èª¤ (poychang.net)</a></li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><a class=tag href=/tags/ef-core/ rel=tag>EF Core</a>
<a class=tag href=/tags/sql-server/ rel=tag>SQL Server</a>
<a class=tag href=/tags/docker/ rel=tag>Docker</a></ul></div></footer><hr><div><p>æ–‡ç« å…§å®¹å‡ç‚ºå€‹äººå­¸ç¿’è¨˜éŒ„ã€å¿ƒå¾—èˆ‡èªçŸ¥ï¼Œè‹¥ä»»ä½•è¬¬èª¤æˆ–å»ºè­°ï¼Œæ­¡è¿ç›´æ¥ç•™è¨€è¨è«–ï¼Œä¸€åŒæˆé•·ã€‚</p></div><iframe class=LikeCoin src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feandev.com%2fpost%2fdevelop%2fdotnet-ef-sqlserver%2f" height=200 width=100% frameborder=0></iframe>
<script src=/js/copy-code-clipboard.min.js></script></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/develop/dotnet-ef-postgresql-dbcontext/ rel=prev><span class=pager__subtitle>Â«&#8201;Previous</span><p class=pager__title>ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/develop/di-service-provider-httpcontextaccessor/ rel=next><span class=pager__subtitle>Next&#8201;Â»</span><p class=pager__title>ASP.NET Core | ä½¿ç”¨ DI æ³¨å…¥æ™‚ï¼Œä½¿ç”¨ Request çš„åƒæ•¸ï¼Œå»ºç«‹ä¸åŒåƒæ•¸çš„ç‰©ä»¶</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var t=document,e=t.createElement('script');e.async=!0,e.src='//eanblog.disqus.com/embed.js',e.setAttribute('data-timestamp',+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 ä¼Šæ©è»Ÿé«”æŠ€è¡“å­¸ç¿’èˆ‡åˆ†äº«.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div></body></html>