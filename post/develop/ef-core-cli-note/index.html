<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>EF Core | CLI Tools 操作筆記 - 伊恩的開發狂想</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7903108559996033" crossorigin=anonymous></script><meta name=description content="記錄 ef tool 內的 DbContext Scaffold 與 code template 的 cli 指令"><meta property="og:title" content="EF Core | CLI Tools 操作筆記"><meta property="og:description" content="記錄 ef tool 內的 DbContext Scaffold 與 code template 的 cli 指令"><meta property="og:type" content="article"><meta property="og:url" content="https://eandev.com/post/develop/ef-core-cli-note/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-08-17T01:29:27+00:00"><meta property="article:modified_time" content="2023-08-17T01:29:27+00:00"><meta itemprop=name content="EF Core | CLI Tools 操作筆記"><meta itemprop=description content="記錄 ef tool 內的 DbContext Scaffold 與 code template 的 cli 指令"><meta itemprop=datePublished content="2023-08-17T01:29:27+00:00"><meta itemprop=dateModified content="2023-08-17T01:29:27+00:00"><meta itemprop=wordCount content="253"><meta itemprop=keywords content="軟體開發,"><meta name=twitter:card content="summary"><meta name=twitter:title content="EF Core | CLI Tools 操作筆記"><meta name=twitter:description content="記錄 ef tool 內的 DbContext Scaffold 與 code template 的 cli 指令"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4HXSCXTZKZ",{anonymize_ip:!1})}</script><link href=/css/syntax.min.css rel=stylesheet><link href=/css/copy-to-clipboard.min.css rel=stylesheet></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class="logo logo--mixed"><a class=logo__link href=/ title=伊恩的開發狂想 rel=home><div class="logo__item logo__imagebox"><img class=logo__img alt=logo src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>伊恩的開發狂想</div><div class=logo__tagline>在知識大海中漂流的小船，不停追尋屬於自己的秘寶。專注於 .NET、雲端技術、系統架構、開發技巧的道、法、術。</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>EF Core | CLI Tools 操作筆記</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>伊恩</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-08-17T01:29:27Z>2023-08-17</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/ef-core/ rel=category>EF Core</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#cli-tools-安裝與更新>CLI Tools 安裝與更新</a><ul><li><a href=#ef-tool-的安裝與更新>EF Tool 的安裝與更新</a></li><li><a href=#使用-ef-core>使用 EF Core</a></li></ul></li><li><a href=#dbcontext-scaffold>DbContext scaffold</a></li><li><a href=#客制-dbcontext-與-entity>客制 DbContext 與 Entity</a></li><li><a href=#補充資料>補充資料</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>將之前使用 dotnet ef 相關的指令整理在這篇，以便後續快速盤查資料使用。</p><h2 id=cli-tools-安裝與更新>CLI Tools 安裝與更新</h2><h3 id=ef-tool-的安裝與更新>EF Tool 的安裝與更新</h3><p>使用 EF Core Tools 之前，需先進行安裝。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 將 dotnet ef 安裝為全域工具</span>
</span></span><span style=display:flex><span>dotnet tool install --global dotnet-ef
</span></span></code></pre></div><p>若曾經安裝過 dotnet-ef 的工具，但後續專案使用最新版本的 EF Core，在執行 <code>dotnet ef</code> 相關指令時，會出現以下的提示訊息。</p><p><code>The Entity Framework tools version '6.0.8' is older than that of the runtime '7.0.1'. Update the tools for the latest features and bug fixes. See https://aka.ms/AAc1fbw for more information.</code></p><p>當發生上述的訊息時，可以使用以下的指令來更新本機內的 EF Core 的 Tools 工具版本。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> dotnet tool update --global dotnet-ef
</span></span></code></pre></div><h3 id=使用-ef-core>使用 EF Core</h3><p>在使用 dotnet-ef 的 context scaffold 之前，別忘了增加下述的套件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet add package Microsoft.EntityFrameworkCore.Design
</span></span></code></pre></div><p>資料庫來源不同，要安裝的不同的 `。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 使用 MS SQL Server</span>
</span></span><span style=display:flex><span>dotnet add package Microsoft.EntityFrameworkCore.SqlServer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 PostgreSQL</span>
</span></span><span style=display:flex><span>dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL
</span></span></code></pre></div><h2 id=dbcontext-scaffold>DbContext scaffold</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>dotnet ef dbcontext scaffold &lt;Connect&gt; &lt;EFCore-PROVIDER&gt; [<span style=color:#66d9ef>options</span>]
</span></span></code></pre></div><p>options 參數說明</p><ul><li><code>--context</code></li><li><code>-f</code>、<code>--force</code>: 強制覆蓋已存在的檔案。</li><li><code>--context-dir</code>: 指定 DbContext 的目錄位置。</li><li><code>-o</code>、<code>--output-dir</code>: 指定 Entity 輸出的位置。</li><li><code>--no-build</code>: 忽略專案需建置成功，才能更新 EF Core 相關的 DbContext 與 Entities。</li><li><code>--no-onconfiguring</code>: 產生的 DbContext，不要包含連線字串資料。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>dotnet ef dbcontext scaffold <span style=color:#e6db74>&#34;Server=localhost;Database=Lab;User Id=sa;Password=AZ@xsw2ec;TrustServerCertificate=true;&#34;</span> Microsoft.EntityFrameworkCore.SqlServer -o Models
</span></span></code></pre></div><h2 id=客制-dbcontext-與-entity>客制 DbContext 與 Entity</h2><p>若想要客制 dbdcontext scaffold 產生出來的 DbContext 與 Entity，可以使用 CodeTemplate 自訂產出的 DbContext 與 Entity。詳細實作可參考 <a href=https://eandev.com/post/develop/dotnet-ef-core-customized-dbcontext-entity/>使用 T4 CodeTemplate 客制化 EFCore Scaffold 產出內容</a>。</p><p>在使用 CLI 的方式來產生 CodeTemplate 前，需先安裝 <code>dotnet new</code> EF Core 範本套件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet new install Microsoft.EntityFrameworkCore.Templates
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 若上述指令無法執行，可將 install 改為 -i</span>
</span></span><span style=display:flex><span>dotnet new -i Microsoft.EntityFrameworkCore.Templates
</span></span></code></pre></div><p>接著到要新增 CodeTemplate 的專案目錄下，執行下述指令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dotnet new ef-templates
</span></span></code></pre></div><p>會在專案目錄下，建立 <code>CodeTemplate\EFCore</code> 資料夾，資料夾內有 <code>DbContext.t4</code> 與 <code>EntityType.t4</code> 兩個檔案，分別對應產出的 DBContext 與 Entity Type。</p><p>不管是使用 <code>EFCore Power Tools > Reverse Enginerring</code>，或是使用 CLI <code>dotnet ef dbcontext scaffold</code>，都會套用 CodeTemplate 內的設定。</p><h2 id=補充資料>補充資料</h2><p>▶ 延伸閱讀</p><ul><li><a href=https://eandev.com/post/develop/dfcore-dbcontext-hasqueryfilter/>使用 HasQueryFilter 限定 DbContext 查詢內容</a></li><li><a href=https://eandev.com/post/develop/dotnet-ef-core-customized-dbcontext-entity/>使用 T4 CodeTemplate 客制化 EFCore Scaffold 產出內容</a></li><li><a href=https://eandev.com/post/develop/dotnet-ef-postgresql-dbcontext/>使用 dotnet-ef 建立 PostgreSQL 的 DbContext</a></li><li><a href=https://eandev.com/post/develop/dotnet-ef-sqlserver/>使用 dotnet-ef 建立 SQL Server on Docker 的 DbContext</a></li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><a class=tag href=/tags/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/ rel=tag>軟體開發</a></ul></div></footer><hr><div><p>文章內容均為個人學習記錄、心得與認知，若任何謬誤或建議，歡迎直接留言討論，一同成長。</p></div><iframe class=LikeCoin src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feandev.com%2fpost%2fdevelop%2fef-core-cli-note%2f" height=200 width=100% frameborder=0></iframe>
<script src=/js/copy-code-clipboard.min.js></script></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/develop/dotnet-ef-core-customized-dbcontext-entity/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>EF Core | 使用 T4 CodeTemplate 客制化 EFCore Scaffold 產出內容</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/series/side-project/shorten-1-build-service-base-on-container/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Docker | 縮網址服務實作記錄 (1)- 基於 Docker Compose 的服務架構</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//eanblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 伊恩軟體技術學習與分享.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div></body></html>