<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Docker | ç¸®ç¶²å€æœå‹™å¯¦ä½œè¨˜éŒ„ (1) - åŸºæ–¼ Docker å®¹å™¨æŠ€è¡“çš„ç¶²ç«™æœå‹™æ¶æ§‹å¯¦è¸ - ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7903108559996033" crossorigin=anonymous></script><meta name=description content="æœ¬æ–‡ç´€éŒ„ä½¿ç”¨ Docker Compose åœ¨ Digital Ocean Ubuntu VPS ä¸Šæ¶è¨­ç¸®ç¶²å€æœå‹™çš„éç¨‹,åŒ…æ‹¬ç’°å¢ƒè¨­å®šã€æœå‹™æ¶æ§‹è¦åŠƒã€Docker image ç®¡ç†ã€ç¶²è·¯èˆ‡å®‰å…¨è¨­å®šç­‰ã€‚é©åˆæƒ³å­¸ç¿’å¦‚ä½•åˆ©ç”¨å®¹å™¨æŠ€è¡“æ¶è¨­ Web æœå‹™çš„è®€è€…ã€‚"><meta property="og:title" content="Docker | ç¸®ç¶²å€æœå‹™å¯¦ä½œè¨˜éŒ„ (1) - åŸºæ–¼ Docker å®¹å™¨æŠ€è¡“çš„ç¶²ç«™æœå‹™æ¶æ§‹å¯¦è¸"><meta property="og:description" content="æœ¬æ–‡ç´€éŒ„ä½¿ç”¨ Docker Compose åœ¨ Digital Ocean Ubuntu VPS ä¸Šæ¶è¨­ç¸®ç¶²å€æœå‹™çš„éç¨‹,åŒ…æ‹¬ç’°å¢ƒè¨­å®šã€æœå‹™æ¶æ§‹è¦åŠƒã€Docker image ç®¡ç†ã€ç¶²è·¯èˆ‡å®‰å…¨è¨­å®šç­‰ã€‚é©åˆæƒ³å­¸ç¿’å¦‚ä½•åˆ©ç”¨å®¹å™¨æŠ€è¡“æ¶è¨­ Web æœå‹™çš„è®€è€…ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://eandev.com/post/series/side-project/shorten-1-build-service-base-on-container/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-11-11T14:28:57+08:00"><meta property="article:modified_time" content="2023-11-11T15:22:30+08:00"><meta itemprop=name content="Docker | ç¸®ç¶²å€æœå‹™å¯¦ä½œè¨˜éŒ„ (1) - åŸºæ–¼ Docker å®¹å™¨æŠ€è¡“çš„ç¶²ç«™æœå‹™æ¶æ§‹å¯¦è¸"><meta itemprop=description content="æœ¬æ–‡ç´€éŒ„ä½¿ç”¨ Docker Compose åœ¨ Digital Ocean Ubuntu VPS ä¸Šæ¶è¨­ç¸®ç¶²å€æœå‹™çš„éç¨‹,åŒ…æ‹¬ç’°å¢ƒè¨­å®šã€æœå‹™æ¶æ§‹è¦åŠƒã€Docker image ç®¡ç†ã€ç¶²è·¯èˆ‡å®‰å…¨è¨­å®šç­‰ã€‚é©åˆæƒ³å­¸ç¿’å¦‚ä½•åˆ©ç”¨å®¹å™¨æŠ€è¡“æ¶è¨­ Web æœå‹™çš„è®€è€…ã€‚"><meta itemprop=datePublished content="2023-11-11T14:28:57+08:00"><meta itemprop=dateModified content="2023-11-11T15:22:30+08:00"><meta itemprop=wordCount content="1370"><meta itemprop=keywords content="Docker,Postgresql,grafana,Ubuntu,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker | ç¸®ç¶²å€æœå‹™å¯¦ä½œè¨˜éŒ„ (1) - åŸºæ–¼ Docker å®¹å™¨æŠ€è¡“çš„ç¶²ç«™æœå‹™æ¶æ§‹å¯¦è¸"><meta name=twitter:description content="æœ¬æ–‡ç´€éŒ„ä½¿ç”¨ Docker Compose åœ¨ Digital Ocean Ubuntu VPS ä¸Šæ¶è¨­ç¸®ç¶²å€æœå‹™çš„éç¨‹,åŒ…æ‹¬ç’°å¢ƒè¨­å®šã€æœå‹™æ¶æ§‹è¦åŠƒã€Docker image ç®¡ç†ã€ç¶²è·¯èˆ‡å®‰å…¨è¨­å®šç­‰ã€‚é©åˆæƒ³å­¸ç¿’å¦‚ä½•åˆ©ç”¨å®¹å™¨æŠ€è¡“æ¶è¨­ Web æœå‹™çš„è®€è€…ã€‚"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4HXSCXTZKZ",{anonymize_ip:!1})}</script><link href=/css/syntax.min.css rel=stylesheet><link href=/css/copy-to-clipboard.min.css rel=stylesheet></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class="logo logo--mixed"><a class=logo__link href=/ title=ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³ rel=home><div class="logo__item logo__imagebox"><img class=logo__img alt=logo src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</div><div class=logo__tagline>åœ¨çŸ¥è­˜å¤§æµ·ä¸­æ¼‚æµçš„å°èˆ¹ï¼Œä¸åœè¿½å°‹å±¬æ–¼è‡ªå·±çš„ç§˜å¯¶ã€‚å°ˆæ³¨æ–¼ .NETã€é›²ç«¯æŠ€è¡“ã€ç³»çµ±æ¶æ§‹ã€é–‹ç™¼æŠ€å·§çš„é“ã€æ³•ã€è¡“ã€‚</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Docker | ç¸®ç¶²å€æœå‹™å¯¦ä½œè¨˜éŒ„ (1) - åŸºæ–¼ Docker å®¹å™¨æŠ€è¡“çš„ç¶²ç«™æœå‹™æ¶æ§‹å¯¦è¸</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>ä¼Šæ©</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-11-11T14:28:57+08:00>2023-11-11</time>
<time class=meta__text datetime=2023-11-11T15:22:30+08:00>(Last Modified: 2023-11-11)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/%E6%9E%B6%E6%A7%8B/ rel=category>æ¶æ§‹</a>, <a class=meta__link href=/categories/%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/ rel=category>ç³»åˆ—æ–‡ç« </a>, <a class=meta__link href=/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/ rel=category>è»Ÿé«”é–‹ç™¼</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#ä¸€æœå‹™ç’°å¢ƒè©•ä¼°é¸æ“‡èˆ‡æœå‹™æ¶æ§‹è¦åŠƒ>ä¸€ã€æœå‹™ç’°å¢ƒè©•ä¼°ã€é¸æ“‡èˆ‡æœå‹™æ¶æ§‹è¦åŠƒ</a><ul><li><a href=#è©•ä¼°èˆ‡è¦åŠƒçš„å…ˆæ±ºæ¢ä»¶>è©•ä¼°èˆ‡è¦åŠƒçš„å…ˆæ±ºæ¢ä»¶</a></li><li><a href=#æœå‹™æ¶æ§‹åœ–>æœå‹™æ¶æ§‹åœ–</a></li></ul></li><li><a href=#ä¸»æ©Ÿè¨­å®š>ä¸»æ©Ÿè¨­å®š</a><ul><li><a href=#è¨­å®šé˜²ç«ç‰†>è¨­å®šé˜²ç«ç‰†</a></li><li><a href=#ä½¿ç”¨è€…æ¬Šé™è¨­å®š>ä½¿ç”¨è€…æ¬Šé™è¨­å®š</a></li><li><a href=#docker-ç¢ºèª>Docker ç¢ºèª</a></li></ul></li><li><a href=#äºŒæœå‹™ä½ˆç½²èˆ‡è¨­å®š>äºŒã€æœå‹™ä½ˆç½²èˆ‡è¨­å®š</a><ul><li><a href=#docker-image-çš„-artifact-ç®¡ç†>Docker Image çš„ Artifact ç®¡ç†</a></li><li><a href=#æœå‹™ä½ˆå±¬>æœå‹™ä½ˆå±¬</a></li></ul></li><li><a href=#è£œå……è³‡æ–™>è£œå……è³‡æ–™</a></li></ul></nav></div></div><div class="content post__content clearfix"><blockquote><p>ç¸®ç¶²å€æœå‹™ç‚º <a href=http://url-ins.com/shorten/>http://url-ins.com/shorten/</a> ï¼Œæœ‰ä»»ä½•æƒ³æ³•æˆ–å›é¥‹ï¼Œå¯ä»¥åœ¨ <a href=https://www.surveycake.com/s/wgveX>SurveyCake</a> ç•™ä¸‹å¯¶è²´çš„æ„è¦‹ã€‚(ç‚ºäº†ç¶­æŒä¸»æ©Ÿçš„ç¶­é‹ï¼Œåœ¨é é¢å…§æ”¾å…¥ Google Adsense å»£å‘Šã€‚)</p></blockquote><blockquote><p>ğŸ”– é•·è©±çŸ­èªª ğŸ”–</p><p>è¨­å®š Ubuntu å…è¨± SSH ä½¿ç”¨å¯†ç¢¼ç™»å…¥æ™‚ï¼Œé™¤äº† <code>/etc/ssh/sshd_config</code> éœ€è¦èª¿æ•´ï¼Œä¹Ÿè¦æª¢æŸ¥ Include å…¶ä»–çš„ <code>.conf</code> æ˜¯å¦æœ‰è¦†å¯«çš„æƒ…æ³ã€‚</p></blockquote><p>ä½¿ç”¨æŠ€è¡“ã€æ¡†æ¶èˆ‡ç’°å¢ƒè¨­å®šå¦‚ä¸‹</p><ul><li>ç¶²è·¯æœå‹™å•†<ul><li>Domain: <a href=https://tw.godaddy.com/>Godaddy</a></li><li>ä¸»æ©Ÿå¹³å°: <a href=https://m.do.co/c/254e8cbe525a>Digital Ocean</a></li><li>ç‰ˆæ§èˆ‡ Container Registry: <a href=https://gitlab.com>GitLab</a></li></ul></li><li>ä½¿ç”¨æœå‹™:<ul><li>Nginx 1.25.3</li><li>Postgresql 16</li><li>Grafana 10.2</li><li>Loki 2.9.2</li></ul></li><li>ä½¿ç”¨æŠ€è¡“<ul><li>Vue3 / <a href=https://astro.build>Astro</a> 3.3</li><li>.NET 7</li></ul></li></ul><p>ä½¿ç”¨ç›¸é—œç·šä¸Šå·¥å…·</p><ul><li><a href="https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhTW">NGINXConfig</a>: Digital Ocean æä¾›çš„ Nginx conf çš„ç”¢ç”Ÿå™¨ï¼Œå¯ç›´æ¥ä½¿ç”¨ä»‹é¢é»é¸å¾Œï¼Œè‡ªå‹•ç”¢ç”Ÿå°æ‡‰çš„ Nginx configã€‚</li></ul><h2 id=ä¸€æœå‹™ç’°å¢ƒè©•ä¼°é¸æ“‡èˆ‡æœå‹™æ¶æ§‹è¦åŠƒ>ä¸€ã€æœå‹™ç’°å¢ƒè©•ä¼°ã€é¸æ“‡èˆ‡æœå‹™æ¶æ§‹è¦åŠƒ</h2><h3 id=è©•ä¼°èˆ‡è¦åŠƒçš„å…ˆæ±ºæ¢ä»¶>è©•ä¼°èˆ‡è¦åŠƒçš„å…ˆæ±ºæ¢ä»¶</h3><ul><li>åœ¨åˆæœŸï¼Œç¶­é‹æˆæœ¬çš„æ”¯å‡ºï¼Œè¦ç›¡å¯èƒ½çš„ä½ã€‚</li><li>ä½¿ç”¨ Docker é€²è¡Œæœå‹™çš„ä½ˆç½²èˆ‡ç®¡ç†ã€‚</li><li>æœå‹™åªå°å¤–é–‹æ”¾ 80/443 PORTï¼Œä»¥åŠ SSH 22 PORTã€‚</li><li>é›†ä¸­æ”¶é›†èˆ‡åˆ†ææœå‹™ç¶­é‹æ™‚çš„ LOGã€‚</li></ul><p>åœ¨ç¶­é‹æˆæœ¬çš„è€ƒé‡ä¸‹ï¼ŒåˆæœŸä½¿ç”¨ä¸€å°ä¸»æ©Ÿä¾†å»ºç½®æ•´å€‹æœå‹™ç³»çµ±ï¼Œä¸¦åŸºæ–¼ Container é€²è¡Œä½ˆç½²èˆ‡ç¶­é‹ã€‚</p><p>æœ€å¾Œé¸æ“‡ Godaddy + <a href=https://m.do.co/c/254e8cbe525a>Digital Ocean</a>(ä½¿ç”¨æ­¤æ¨è–¦é€£çµï¼Œå¯ç²å¾— $200 çš„ä½¿ç”¨é¡åº¦) å–®ä¸€ä¸»æ©Ÿå»ºç«‹æœå‹™ã€‚</p><p>åœ¨ Docker Image çš„ Artiact çš„ç®¡ç†éƒ¨ä»½ï¼Œæœ€åˆçš„é¸æ“‡ï¼Œæ˜¯ç›´æ¥ä½¿ç”¨ Digital Ocean çš„ <code>Container Registry</code> ã€‚ä½†è€ƒé‡ Free Plan åªèƒ½ä½¿ç”¨ä¸€å€‹ Repoï¼Œè€Œé€™å€‹å°ˆæ¡ˆæœ‰ä½¿ç”¨è‡³å°‘ 2 å€‹ Imageã€‚</p><p>å¾Œé¢è½‰ç‚ºä½¿ç”¨ GitLab çš„ Container registryï¼Œä¸»è¦çš„åŸå› ï¼Œæ˜¯å› ç‚ºå®ƒ Unlimit Private Container registryã€‚</p><h3 id=æœå‹™æ¶æ§‹åœ–>æœå‹™æ¶æ§‹åœ–</h3><p><figure><center><img src=images/service-arch.png alt="VPS å…§çš„æœå‹™æ¶æ§‹"><figcaption>VPS å…§çš„æœå‹™æ¶æ§‹</figcaption></center></figure></p><h4 id=æœå‹™>æœå‹™</h4><p>æœ€åˆæ˜¯å¸Œæœ›æœ‰éœ€è¦çš„ä½¿ç”¨æœå‹™çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå¯ä»¥ç›´æ¥èª¿ç”¨ APIï¼Œæ‰€ä»¥è¨­è¨ˆæ˜¯ä»¥ API First çš„æ–¹å¼ï¼Œä¾†é€²è¡Œé–‹ç™¼è¦åŠƒã€‚åŒæ™‚ï¼Œä¹Ÿè®“æä¾›ä¸€èˆ¬ä½¿ç”¨è€…ï¼Œå¯ä»¥é€²è¡ŒåŸºæœ¬çš„æ“ä½œã€‚</p><p>å› æ­¤ï¼Œé€™æ¬¡ä¸»è¦çš„é–‹ç™¼çš„é …ç›®ï¼Œä¸»è¦é›†ä¸­åœ¨é¢å°ä½¿ç”¨è€…çš„å‰ç«¯é é¢å‘ˆç¾ï¼Œä»¥åŠ Web API åŠŸèƒ½çš„éƒ¨ä»½ã€‚</p><p>å‰ç«¯é é¢é¸æ“‡ä½¿ç”¨ Astro + Vue3 é€™å°çµ„åˆã€‚ä¸»è¦æ˜¯ Astro å»ºç½®å‡ºä¾†çš„éœæ…‹ç¶²é ï¼Œå° SEO èˆ‡ç¶²é é€Ÿåº¦æœ‰è‘—ä¸éŒ¯æ•ˆèƒ½ã€‚Vue3 å‰‡æ˜¯ç”¨æ–¼ä½¿ç”¨è€…äº’å‹•çš„éƒ¨ä»½ã€‚(å› ç‚ºç›®å‰åªå° Vue3 æœ‰äº›è¨±çš„ç¶“é©—)</p><p>Web API çš„éƒ¨ä»½ï¼Œå‰‡æ˜¯ä½¿ç”¨æœ€ç†Ÿæ‚‰çš„ .NET Coreï¼Œé †ä¾¿å˜—è©¦ .NET 7 ä¹‹å¾Œçš„æ•ˆèƒ½èˆ‡æ”¯æ´çš„èªæ³•ã€‚</p><p>è³‡æ–™åº«å‰‡æ˜¯é¸æ“‡ä½¿ç”¨å¾Œèµ·æ–°ç§€çš„ Postgresqlï¼Œæœ€ä¸»è¦çš„è€ƒé‡ï¼Œæœ€ç†Ÿæ‚‰çš„ MS SQL SERVER çš„ Lincese è²»ç”¨ï¼Œä¸æ˜¯ä¸€èˆ¬ Side Project å¯ä»¥æ‰¿å—ã€‚è€Œä¸”å¾Œç¹¼è½‰æ›ç‚ºé›²ç«¯æœå‹™å•† Serverless RDS çš„æˆæœ¬ä¹Ÿåœ¨å¯æ¥å—ç¯„åœã€‚(ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯æˆæœ¬è€ƒé‡)</p><p>åœ¨ç›£æ§èˆ‡ç¶­é‹å ±è­¦çš„éƒ¨ä»½ï¼Œå‰‡æ˜¯ç›´æ¥é¸æ“‡ä½¿ç”¨ Grafana å…¨å¥—ï¼Œæœ‰ä¸€å€‹è€ƒé‡ï¼Œå°±æ˜¯é‹ç”¨ Grafana æ”¯æ´çš„ OpenTelemetry ä¾†é€²ä¸€æ­¥ç ”ç©¶ OpenTelemetryã€‚</p><h4 id=ç¶²è·¯è¦åŠƒ>ç¶²è·¯è¦åŠƒ</h4><p>åœ¨ Digital Ocean çš„ VPS é˜²ç«ç‰†åªé–‹æ”¾ 80/443/22 é€™å¹¾å€‹éœ€è¦çš„ PORTã€‚</p><p>åœ¨ä¸»æ©Ÿå…§ï¼Œç›´æ¥ä½¿ç”¨ Docker netowrk ä¾†é€²è¡Œç¶²æ®µçš„åˆ‡åˆ†ã€‚åœ¨é€™åœ¨å°ˆæ¡ˆï¼Œåªæœ‰ç°¡å–®é€²è¡Œä»¥ä¸‹åˆ‡åˆ†ã€‚</p><table><thead><tr><th>Network-name</th><th>èªªæ˜</th></tr></thead><tbody><tr><td>gateway</td><td>NGINX/WEB èˆ‡ Web API æ‰€åœ¨çš„ç¶²æ®µã€‚</td></tr><tr><td>backend</td><td>Web API èˆ‡ Database æ‰€åœ¨çš„ç¶²æ®µã€‚</td></tr><tr><td>ops</td><td>Grafana ç›¸é—œæœå‹™èˆ‡ Web API æ‰€åœ¨çš„ç¶²æ®µã€‚</td></tr></tbody></table><p>ç›®å‰åªæœ‰é€™æ¨£ç°¡å–®åˆ‡åˆ†ç¶²æ®µï¼Œå¾ŒçºŒæœ‰æ©Ÿæœƒï¼Œæœƒä¾æ“š <a href=https://docs.docker.com/engine/security/>Docker security</a> çš„èªªæ˜ï¼Œé€²ä¸€æ­¥é€²è¡Œ security ç›¸é—œçš„è¨­å®šã€‚</p><h2 id=ä¸»æ©Ÿè¨­å®š>ä¸»æ©Ÿè¨­å®š</h2><p>åœ¨æœå‹™ä¸»æ©Ÿçš„ OS éƒ¨ä»½ï¼Œä½¿ç”¨ Ubuntu Ubuntu 22.04.3 LTSã€‚</p><p>æœ‰ä»¥ä¸‹çš„è¦æ±‚è¨­å®š</p><ul><li>å°å¤–åªé–‹æ”¾ 80/443 èˆ‡ SSH ä½¿ç”¨çš„ 22 PORT</li><li>æ“ä½œåªèƒ½ä½¿ç”¨ç‰¹å®šå¸³è™Ÿï¼Œä¾†æ“ä½œ Docker çš„æ“ä½œã€‚</li></ul><h3 id=è¨­å®šé˜²ç«ç‰†>è¨­å®šé˜²ç«ç‰†</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># ç¢ºèªç›®å‰é˜²ç«ç‰†ç‹€æ…‹</span>
</span></span><span style=display:flex><span>ufw status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¨­å®šè¦å‰‡</span>
</span></span><span style=display:flex><span>ufw allow 80/tcp
</span></span><span style=display:flex><span>ufw allow 443/tcp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é–‹å•Ÿé˜²ç«ç‰†</span>
</span></span><span style=display:flex><span>ufw enable
</span></span></code></pre></div><p><figure><center><img src=images/ubuntu-ufw-status.jpeg alt="ufw status"><figcaption>ufw status</figcaption></center></figure></p><h3 id=ä½¿ç”¨è€…æ¬Šé™è¨­å®š>ä½¿ç”¨è€…æ¬Šé™è¨­å®š</h3><p>æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æŒ‡ä»¤ä¾†æ–°å¢ä½¿ç”¨è€…ï¼Œåœ¨é€™é‚Šä»¥ <code>opser</code> é€™å€‹ä½¿ç”¨è€…åç¨±ç‚ºä¾‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo adduser æ–°ä½¿ç”¨è€…åç¨±
</span></span><span style=display:flex><span>sudo usermod -aG sudo æ–°ä½¿ç”¨è€…åç¨±
</span></span><span style=display:flex><span>su - æ–°ä½¿ç”¨è€…åç¨±
</span></span></code></pre></div><p><figure><center><img src=images/ubuntu-adduser.jpeg alt><figcaption></figcaption></center></figure></p><h4 id=ä½¿ç”¨å¯†ç¢¼é©—è­‰-password-authenticaiton>ä½¿ç”¨å¯†ç¢¼é©—è­‰ (Password Authenticaiton)</h4><p>è‹¥æ˜¯å¾ŒçºŒæƒ³è¦ä½¿ç”¨å¯†ç¢¼ä¾†é€²è¡Œ SSH é€£ç·šï¼Œè‹¥ <code>sshd_config</code> å…§çš„ <code>PasswordAuthentication</code> ç‚º <code>no</code>ï¼Œä½¿ç”¨ SSH ç™»å…¥æ™‚ï¼Œæœƒç›´æ¥å‡ºç¾ <code>Permission denied (publickey).</code> éŒ¯èª¤ã€‚</p><p>Ditigal Ocean é–‹ç«‹çš„ Ubuntu ä¸»æ©Ÿï¼Œé è¨­æ˜¯é—œé–‰ <code>PasswordAuthentication</code> çš„ï¼Œè‹¥è¦ä½¿ç”¨å¯†ç¢¼èªè­‰ï¼Œéœ€è¦é€²è¡Œä¸€äº›è¨­å®š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat /etc/ssh/sshd_config | grep
</span></span></code></pre></div><p><figure><center><img src=images/ubuntu-user-password-auth-1.jpeg alt="ç¢ºèª sshd_config å…§çš„è¨­å®š"><figcaption>ç¢ºèª sshd_config å…§çš„è¨­å®š</figcaption></center></figure></p><p>é–‹å•Ÿå¯†ç¢¼èªè­‰çš„è¨­å®šï¼Œå°‡ <code>PasswordAuthentication</code> è¨­ç‚º <code>yes</code>ã€‚</p><p><figure><center><img src=images/ubuntu-user-password-auth-2.jpeg alt="åœ¨èª¿æ•´å¾Œï¼Œå†æ¬¡ç¢ºèª sshd_config"><figcaption>åœ¨èª¿æ•´å¾Œï¼Œå†æ¬¡ç¢ºèª sshd_config</figcaption></center></figure></p><p>é‡å•Ÿ <code>sshd</code> æœå‹™ï¼Œè®“ <code>PasswordAuthentication</code> è®Šå‹•ç”Ÿæ•ˆã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl restart sshd
</span></span></code></pre></div><p>ğŸ“¢ é¡Œå¤–è©±ï¼šæ”¹å®Œäº†è¨­å®šï¼Œä½†é‚„æ˜¯ç„¡æ³•ä½¿ç”¨å¯†ç¢¼ç™»å…¥ï¼ï¼</p><p>åœ¨ <code>/etc/ssh/sshd_config</code> æœ‰ä¸€è¡ŒæŒ‡ä»¤è¦ç‰¹åˆ¥æ³¨æ„ï¼Œå®ƒæœƒåœ¨è¼‰å…¥ <code>sshd_config</code> çš„è¨­å®šå¾Œï¼Œå†å»è¼‰å…¥å…¶ä»–çš„ <code>*.conf</code> è¨­å®šå€¼ã€‚è‹¥å‡ºç¾ç›¸åŒçš„è¨­å®šï¼Œå¾Œè€…çš„è¨­å®šå€¼æœƒè¦†å¯«å‰é¢ã€‚</p><p>åœ¨ Digital Ocean å»ºç«‹çš„ä¸»æ©Ÿï¼Œ<code>/etc/ssh/</code> å…§æœ‰ä¸€å€‹è³‡æ–™å¤¾ <code>sshd_config.d</code>ï¼Œå…¶ä¸­æœ‰ä¸€å€‹ <code>50-cloud-init.conf</code> æª”æ¡ˆï¼Œæœƒå°‡ <code>PasswordAuthentication</code> è¦†å¯«ç‚º <code>no</code>ã€‚</p><p>ç•¶æˆ‘å€‘å·²ç¶“å®Œæˆèª¿æ•´ï¼Œå˜—è©¦ä½¿ç”¨ SSH å¯†ç¢¼ç™»å…¥æ™‚ï¼Œé‚„æ˜¯å‡ºç¾ <code>Permission denied (publickey).</code> çš„è¨Šæ¯ã€‚è¨˜å¾—å»æª¢æŸ¥æ˜¯ä¸æ˜¯é€™å€‹å•é¡Œã€‚</p><h4 id=ä½¿ç”¨-ssh-key-èªè­‰>ä½¿ç”¨ SSH Key èªè­‰</h4><p>è‹¥æˆ‘å€‘ä¸é–‹æ”¾å¯†ç¢¼èªè­‰ï¼Œåªå…è¨±æ–°çš„ä½¿ç”¨è€…ï¼Œåªèƒ½ä½¿ç”¨ SSH Key å»é€²è¡Œç™»å…¥èªè­‰ã€‚</p><p>åœ¨ <a href=https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1604>How To Set Up SSH Keys on Ubuntu 16.04 | DigitalOcean</a> é€™ä¸€ç¯‡æ–‡ç« ï¼Œå…¶å¯¦å¯«çš„é‚„æ»¿æ¸…æ¥šçš„ã€‚</p><p>ç›®å‰çš„æƒ…å¢ƒ: Ubuntu ä¸»æ©Ÿåªé–‹æ”¾ <code>root</code> ä½¿ç”¨ SSH Key èªè­‰ï¼Œä¸é–‹æ”¾å¯†ç¢¼èªè­‰ï¼Œæ–°ä½¿ç”¨è€…ç„¡æ³•ç™»å…¥çš„å‰æä¸‹ï¼Œé€²è¡Œè¨­å®šã€‚</p><p>å¯ä½¿ç”¨ä»¥ä¸‹çš„æ­¥é©Ÿä¾†é€²è¡Œè¨­å®šã€‚</p><ul><li>ä½¿ç”¨ <code>ssh-keygen</code> å»ºç«‹æ–°çš„å…¬ç§é‘°ã€‚</li><li>å°‡ SSH ä½¿ç”¨çš„ Public Key è¤‡åˆ¶åˆ° Ubuntu ä¸»æ©Ÿã€‚</li><li>å»ºç«‹ä½¿ç”¨è€…çš„ <code>authorized_keys</code> èˆ‡å°æ‡‰çš„ <code>.ssh</code> è¨ªå•æ¬Šé™ã€‚</li></ul><p>é¦–å…ˆï¼Œå…ˆç”¢ç”Ÿæ–°ä½¿ç”¨è€… <code>opser</code> ä½¿ç”¨çš„ SSH Keyã€‚</p><p><figure><center><img src=images/ssh-keygen-key.jpeg alt="ä½¿ç”¨ ssh-keygen ç”¢ç”Ÿ public/private key"><figcaption>ä½¿ç”¨ ssh-keygen ç”¢ç”Ÿ public/private key</figcaption></center></figure></p><p>æ¥è‘—ï¼Œè®“æˆ‘å€‘æŠŠ Public Key æ”¾åˆ° Ubuntu ä¸»æ©Ÿï¼Œä¸¦é€²è¡Œ <code>authorized_keys</code> èˆ‡å°æ‡‰çš„ <code>.ssh</code> è¨ªå•æ¬Šé™è¨­å®šã€‚</p><p>åœ¨é€™ï¼Œæˆ‘å…ˆæŠŠå»ºç«‹å‡ºä¾†çš„ Public Key (digitalocean_opser.pub) ä½¿ç”¨ <code>SCP</code> ä¸Šå‚³åˆ° Ubuntu ä¸»æ©Ÿçš„ <code>/</code> è·¯å¾‘ä¸‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># å› ç‚ºæˆ‘å€‘å…ˆç™»å…¥ root, æ‰€ä»¥è¦åˆ‡åˆ°è¦èª¿æ•´çš„ä½¿ç”¨è€…å¸³è™Ÿ opser ä¸‹</span>
</span></span><span style=display:flex><span>su - opser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è‹¥æ²’æœ‰ .ssh è³‡æ–™å¤¾ï¼Œå°±å»ºç«‹ã€‚</span>
</span></span><span style=display:flex><span>mkdir -p ~/.ssh
</span></span><span style=display:flex><span><span style=color:#75715e># å»ºç«‹ authorized_keys</span>
</span></span><span style=display:flex><span>touch ~/.ssh/authorized_keys
</span></span><span style=display:flex><span><span style=color:#75715e># è¨­å®š .ssh çš„è®€å–æ¬Šé™</span>
</span></span><span style=display:flex><span>chmod -R go<span style=color:#f92672>=</span> ~/.ssh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æŠŠ /digitalocean_opser.pub çš„å…§å®¹æ”¾åˆ° /home/opser/.ssh/authorized_keys å…§ã€‚</span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯¦éš›æ“ä½œï¼Œè«‹ä½œå¯¦éš›åç¨±èª¿æ•´</span>
</span></span><span style=display:flex><span>cat /digitalocean_opser.pub &gt;&gt; ~/.ssh/authorized_keys
</span></span></code></pre></div><p><figure><center><img src=images/set-ubuntu-user-ssh-key-1.jpeg alt><figcaption></figcaption></center></figure></p><p><figure><center><img src=images/set-ubuntu-user-ssh-key-2.jpeg alt><figcaption></figcaption></center></figure></p><p>å®Œæˆä¸Šè¿°æŒ‡ä»¤ä¹‹å¾Œå°±å¯ä»¥é †åˆ©çš„ä½¿ç”¨ opser ä»¥ SSH Key ç™»å…¥ã€‚</p><p><figure><center><img src=images/new-user-ssh-key-success.png alt="ä½¿ç”¨ opser é †åˆ©ç™»å…¥ Ubuntu ä¸»æ©Ÿ"><figcaption>ä½¿ç”¨ opser é †åˆ©ç™»å…¥ Ubuntu ä¸»æ©Ÿ</figcaption></center></figure></p><h3 id=docker-ç¢ºèª>Docker ç¢ºèª</h3><p>å¯ä»¥ä½¿ç”¨ <code>docker --version</code> ä¾†ç¢ºèªç›®å‰ Ubuntu ä¸Šå®‰è£çš„ docker ç‰ˆæœ¬ã€‚è‹¥é‚„æ²’æœ‰å®‰è£ï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶
(<a href=https://docs.docker.com/engine/install/ubuntu/>Install Docker Engine on Ubuntu | Docker Docs</a>) çš„èªªæ˜ï¼Œé€²è¡Œå®‰è£ã€‚</p><p>åœ¨é€™é‚Šï¼Œæ¡ç”¨å¢åŠ  <code>apt</code> Repository çš„æ–¹å¼ï¼Œä¾†é€²è¡Œ Docker çš„å®‰è£ã€‚ä¸‹é¢ç°¡å–®èªªæ˜å¹¾å€‹æ­¥é©Ÿã€‚</p><h4 id=1-å¢åŠ -docker-çš„-apt-repository>1. å¢åŠ  Docker çš„ apt Repository</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Add Docker&#39;s official GPG key:</span>
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install ca-certificates curl gnupg
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0755</span> -d /etc/apt/keyrings
</span></span><span style=display:flex><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span><span style=display:flex><span>sudo chmod a+r /etc/apt/keyrings/docker.gpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add the repository to Apt sources:</span>
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#e6db74>&#34;deb [arch=&#34;</span><span style=color:#66d9ef>$(</span>dpkg --print-architecture<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;</span><span style=color:#66d9ef>$(</span>. /etc/os-release <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;</span>$VERSION_CODENAME<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34; stable&#34;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style=display:flex><span>sudo apt-get update
</span></span></code></pre></div><p>åœ¨ç¢ºä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„å¥—ä»¶å‰æä¸‹ï¼Œä¸‹è¼‰ Docker çš„ GPG public keyï¼Œä»¥ç¢ºä¿ä¸‹è¼‰çš„ Docker æ˜¯å®˜æ–¹çš„ç‰ˆæœ¬ã€‚</p><h4 id=2-å®‰è£-docker-ç›¸é—œå¥—ä»¶>2. å®‰è£ Docker ç›¸é—œå¥—ä»¶</h4><p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Docker å¥—ä»¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span></code></pre></div><p>æ¸¬è©¦æ˜¯å¦å®‰è£æˆåŠŸã€‚å¦‚æœèƒ½çœ‹åˆ° <code>Hello from Docker!</code> è¨Šæ¯ï¼Œè¡¨ç¤º Docker å·²æˆåŠŸå®‰è£…ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run hello-world
</span></span></code></pre></div><h4 id=åŠ å…¥-docker-ç”¨æˆ¶çµ„é¸é …>åŠ å…¥ docker ç”¨æˆ¶çµ„(é¸é …)</h4><p>è‹¥æ˜¯å¾ŒçºŒåœ¨åŸ·è¡Œ <code>docker</code> æŒ‡ä»¤æ™‚ï¼Œä¸æƒ³è¦æ¯æ¬¡éƒ½éƒ½è¦è¼¸å…¥ <code>sudo</code> çš„è©±ï¼Œåˆ¥å¿˜äº†åœ¨ç”¨æˆ¶çµ„å…§ï¼ŒåŠ å…¥ docker æ“ä½œæ¬Šé™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG docker <span style=color:#e6db74>${</span>USER<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å•Ÿ Docker</span>
</span></span><span style=display:flex><span>sudo systemctl restart docker
</span></span></code></pre></div><h2 id=äºŒæœå‹™ä½ˆç½²èˆ‡è¨­å®š>äºŒã€æœå‹™ä½ˆç½²èˆ‡è¨­å®š</h2><h3 id=docker-image-çš„-artifact-ç®¡ç†>Docker Image çš„ Artifact ç®¡ç†</h3><h4 id=docker-login>docker login</h4><p>åœ¨æŠŠå»ºç½®å‡ºä¾†çš„ Image Push åˆ° Container Registry ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å…ˆç™»å…¥è¦å­˜æ”¾ Image çš„ Container Registryã€‚</p><pre tabindex=0><code>docker login &lt;container-registry-host&gt;
</code></pre><p>é€™é‚Šä»¥ Digital Ocean çš„ Container Registry(registry.digitalocean.com) ç‚ºä¾‹ã€‚</p><p>åªè¦åœ¨ <code>Username</code> èˆ‡ <code>Password</code> è¼¸å…¥æ­£ç¢ºçš„èªè­‰è³‡æ–™ï¼Œå°±å¯ä»¥é †åˆ©ç™»å…¥ã€‚è‡³æ–¼èªè­‰è³‡æ–™è¼¸å…¥çš„å…§å®¹ï¼Œè«‹æŸ¥çœ‹å„ Container Registry çš„è¦æ±‚ã€‚</p><p>ä¾‹å¦‚ Digital Ocean çš„èªè­‰è³‡æ–™ï¼Œå°±éœ€è¦å…ˆå»ç”³è«‹ API Token å¾Œï¼Œå†æŠŠ Token è¼¸å…¥ Username/Passwordã€‚</p><p><figure><center><img src=images/docker-login-digitalocean.jpeg alt="docker login DigitalOcean"><figcaption>docker login DigitalOcean</figcaption></center></figure>åœ¨æˆåŠŸç™»å…¥ï¼Œå°±å¯ä»¥åœ¨å…è¨±çš„æ¬Šé™ä¸‹ï¼Œé€²è¡Œ Container Registry æ“ä½œã€‚</p><h4 id=docker-push-image>docker push image</h4><p>åœ¨ Push åˆ° Container Registry ä¹‹å‰ï¼Œä¾†çœ‹ä¸€ä¸‹ Docker å®˜ç¶²çš„<a href=https://docs.docker.com/engine/reference/commandline/push/>èªªæ˜</a>ã€‚</p><p>å¯ä»¥è—‰ç”± Push çš„æŒ‡ä»¤ï¼Œå°‡ Image åˆ†äº«åˆ° Docker Hub æˆ–è‡ªå»ºçš„ Container Registryã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker push <span style=color:#f92672>[</span>OPTIONS<span style=color:#f92672>]</span> NAME:<span style=color:#f92672>[</span>Tag<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>é€™å€‹æœ‰å€‹å°ç´°ç¯€ã€‚</p><p>ç•¶æˆ‘å€‘é€£åˆ° <a href=https://docs.docker.com/engine/reference/commandline/tag/>docker tag | Docker Docs</a> é€²ä¸€æ­¥æŸ¥çœ‹è³‡è¨Šæ™‚ï¼Œæœƒç™¼ç¾ docker push çš„ <code>NAME</code> çš„å…§å®¹æ ¼å¼ç‚º <code>[HOST[:PORT]/]PATH</code>ï¼Œç”± <code>HOST</code>ã€<code>PORT</code> èˆ‡ <code>PATH</code> ä¸‰è€…çµ„æˆã€‚</p><p>è‹¥æ˜¯æ²’æœ‰æŒ‡å®š <code>HOST</code>ï¼Œé è¨­æŒ‡å‘ Docker Hub æ‰€åœ¨çš„ <code>docker.io</code>ã€‚</p><p>é€™æ„å‘³è‘—ï¼Œè‹¥æ˜¯æƒ³è¦æŠŠè‡ªè¡Œç”¢ç”Ÿçš„ Image ä¸Šå‚³åˆ° Digital Ocean Container Registryã€‚åœ¨ä¸Šå‚³ä¹‹å‰ï¼Œå°±å¿…é ˆä½¿ç”¨ <code>docker tag</code> é€²è¡Œåç¨±çš„èª¿æ•´ï¼Œå°‡ Image åç¨±åŠ ä¸Š <code>HOST</code> è³‡è¨Šã€‚</p><p>ä»¥ Digital Ocean Container Registry ç‚ºä¾‹ï¼Œè‹¥æ˜¯è¦ä¸Šå‚³ <code>url-insight/web</code> åˆ° Digital Ocean Container Registry çš„ Repo(url-insight) ä¹‹ä¸­ï¼Œå°±éœ€è¦åŸ·è¡Œä¸‹è¿°æŒ‡ä»¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># docker tag &lt;image-name&gt;:&lt;tag&gt; registry.digitalocean.com/&lt;registry-name&gt;/&lt;image-name&gt;:&lt;tag&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker tag url-insight/web:latest registry.digitalocean.com/my-registry/url-insight/web:latest
</span></span></code></pre></div><p>å®Œæˆæ›´åå¾Œï¼Œå°±å¯ä»¥æŠŠ Image ä¸Šå‚³åˆ° Digital Ocean Container Registryã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker push registry.digitalocean.com/&lt;registry-name&gt;/&lt;image-name&gt;:&lt;tag&gt;
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œå°‡ <code>url-insight/web</code> æ˜ åƒæ¨é€åˆ° Container Registryï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker push registry.digitalocean.com/my-registry/url-insight/web:latest
</span></span></code></pre></div><p><figure><center><img src=images/cli-push-image-to-digital-ocean.png alt="Push image åˆ° Digital Ocean Container Registry"><figcaption>Push image åˆ° Digital Ocean Container Registry</figcaption></center></figure></p><p>å®Œæˆ Push å¾Œï¼Œå°±å¯ä»¥åœ¨ Digital Ocean Container Registry æŸ¥åˆ°ä¸Šå‚³çš„ Image è¨˜éŒ„ã€‚</p><p><figure><center><img src=images/digital-ocean-container-registry-push-result.jpeg alt><figcaption></figcaption></center></figure></p><h4 id=è®Šæ›´ä½¿ç”¨çš„-container-registry>è®Šæ›´ä½¿ç”¨çš„ Container Registry</h4><p>åœ¨å®Œæˆ <code>uri-insight/web</code> çš„ Image ä¸Šå‚³å¾Œï¼Œç¹¼çºŒä¸Šå‚³ <code>uri-insight/api</code> çš„ Docker Image æ™‚ï¼Œå‡ºç¾ <code>denied: registry contains 1 repositories, limit is 1</code> éŒ¯èª¤ã€‚</p><p><figure><center><img src=images/push-image-denied.png alt="Push Image åˆ° Digital Ocean æ™‚ï¼Œè¢«æ‹’çµ•"><figcaption>Push Image åˆ° Digital Ocean æ™‚ï¼Œè¢«æ‹’çµ•</figcaption></center></figure></p><p>é€™æ™‚ï¼Œæˆ‘æ‰ç™¼ç¾çŠ¯äº†ä¸€å€‹èªçŸ¥çš„éŒ¯èª¤ã€‚</p><p>åŸæœ¬æŸ¥çœ‹ Digital Ocean çš„ Registry çš„å…è²»æ–¹æ¡ˆæ™‚ï¼Œä»¥ç‚º Digitial Coean çš„ Starter plan çš„ 1 Repoï¼ŒæŒ‡çš„æ˜¯ Project level çš„ Repositoryã€‚</p><p><figure><center><img src=images/digital-ocean-container-registry-payment-plan.jpeg alt><figcaption></figcaption></center></figure></p><p>æƒ³èªªå¯ä»¥å°‡å¯¦ä½œçš„æœå‹™ï¼Œ<code>uri-insight/web</code> èˆ‡ <code>uri-insight/api</code> å…©å€‹ Imageï¼Œéƒ½ä¸Šå‚³åˆ°åŒä¸€å€‹ Repoã€‚</p><p>åœ¨å¯¦ä½œä½¿ç”¨æ™‚ï¼Œæ‰ç™¼ç¾å®ƒæŒ‡çš„æ˜¯ Docker Image Repositoryï¼Œåªè¦ä¸åŒçš„ NAMEï¼Œå°±æœƒè¦–ç‚ºä¸åŒçš„ REPOã€‚</p><p>æ‰€ä»¥ push ç¬¬äºŒå€‹ Docker Image æ™‚ï¼Œæ‰æœƒå‡ºç¾äº† <code>denied: registry contains 1 repositories, limit is 1</code> éŒ¯èª¤ã€‚</p><p><figure><center><img src=images/push-image-denied.png alt="Push Image åˆ° Digital Ocean æ™‚ï¼Œè¢«æ‹’çµ•"><figcaption>Push Image åˆ° Digital Ocean æ™‚ï¼Œè¢«æ‹’çµ•</figcaption></center></figure></p><p>å‰›å¥½ï¼Œä½¿ç”¨çš„ç‰ˆæ§çš„ Gitlab å¹³å°ï¼Œä¹Ÿæœ‰æä¾› Container registryï¼Œè€Œä¸”ï¼Œåœ¨å®˜æ–¹çš„ <a href=https://docs.gitlab.com/ee/user/packages/container_registry/>GitLab Container Registry èªªæ˜æ–‡ä»¶</a>ä¸­æåˆ°ï¼Œå®ƒå€‘æä¾›çš„ Private Container Registry æ²’æœ‰æ•¸é‡é™åˆ¶ã€‚</p><p>æ‰€ä»¥æ±ºå®šç§»åˆ° GitLab é€™å€‹ Unlimit Private Container Registryã€‚</p><p><figure><center><img src=images/gitlab-container-registry-entry.jpeg alt="Container Registry é€²å…¥ä½ç½®"><figcaption>Container Registry é€²å…¥ä½ç½®</figcaption></center></figure></p><p><figure><center><img src=images/gitlab-container-registory.jpeg alt="GitLab çš„ Container Registry ç•«é¢"><figcaption>GitLab çš„ Container Registry ç•«é¢</figcaption></center></figure></p><p>é¡Œå¤–è©±ï¼Œåœ¨ Container Registry çš„å‘ˆç¾ç•«é¢ï¼Œå€‹äººæ¯”è¼ƒå–œæ­¡ Digital Ocean çš„å‘ˆç¾æ–¹å¼</p><p><figure><center><img src=images/digitial-ocean-container-registry.jpeg alt="Digital Ocean çš„ Container Registry ç•«é¢"><figcaption>Digital Ocean çš„ Container Registry ç•«é¢</figcaption></center></figure></p><h3 id=æœå‹™ä½ˆå±¬>æœå‹™ä½ˆå±¬</h3><p>åœ¨æœå‹™ä½ˆç½²çš„éƒ¨ä»½ï¼Œåœ¨é‚„æ²’æœ‰å»ºç«‹ CI/CD æµç¨‹ä¹‹å‰ã€‚ä½¿ç”¨ <code>scp</code> çš„æŒ‡ä»¤ï¼Œé€é SSHï¼Œå°‡æœå‹™ç›¸é—œçš„ <code>*.yml</code> èˆ‡ <code>nginx.conf</code> ç­‰æª”æ¡ˆå‚³è¼¸åˆ°æœå‹™ä¸»æ©Ÿã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># å–®ä¸€æª”æ¡ˆ</span>
</span></span><span style=display:flex><span>scp <span style=color:#f92672>[</span>source-host:<span style=color:#f92672>]</span>&lt;ä¾†æºæª”æ¡ˆ&gt; <span style=color:#f92672>[</span>å¸³è™Ÿ@target-host<span style=color:#f92672>]</span>:&lt;ç›®åœ°æª”æ¡ˆ&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è³‡æ–™å¤¾</span>
</span></span><span style=display:flex><span>scp -r <span style=color:#f92672>[</span>source-host:<span style=color:#f92672>]</span>&lt;ä¾†æºè³‡æ–™å¤¾&gt; <span style=color:#f92672>[</span>å¸³è™Ÿ@target-host<span style=color:#f92672>]</span>:&lt;ç›®åœ°è³‡æ–™å¤¾&gt;
</span></span></code></pre></div><p>å¾ŒçºŒä½¿ç”¨ <code>docker compose</code> ä¾†å»ºç«‹ Container æ™‚ï¼Œéœ€è¦å¾ Container Registry ä¸‹è¼‰æ‰€éœ€è¦çš„ Docker Imageã€‚æ‰€ä»¥ä¸è¦å¿˜è¨˜å…ˆé€²è¡Œ <code>docker login</code> çš„å‹•ä½œã€‚</p><p>åœ¨ url-insight çš„æœå‹™ï¼Œ<code>docker compose</code> ç›¸é—œçš„ <code>.yml</code> çš„è¨­å®šèˆ‡èªªæ˜å¦‚ä¸‹ã€‚</p><h4 id=ç¶²æ®µè¨­å®š>ç¶²æ®µè¨­å®š</h4><p>è‹¥æƒ³è¦ä½¿ç”¨ <code>docker compose</code> ä¾†çµ±ä¸€ç®¡ç† Container æ™‚ï¼Œ<code>docker compose</code> æœƒè‡ªå‹•å»ºç«‹å°æ‡‰è©² <code>.yml</code> è¨­å®šæª”å…§ networkã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo docker compose up -p proj up -d
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°çš„ä¾‹å­ï¼Œå› ç‚ºæŒ‡å®š <code>docker compose</code> å•Ÿå‹•ä¸€å€‹åç‚º proj çš„å°ˆæ¡ˆï¼Œæ‰€ä»¥å®ƒåœ¨èƒŒå¾Œï¼Œæœƒè‡ªè¡Œå»ºç«‹ä¸€å€‹åç‚º <code>proj-network</code> çš„ Docker networkã€‚</p><p>ä½†åœ¨è¦åŠƒä¸­ï¼Œå¸Œæœ›å•Ÿç”¨çš„ Container åˆ†åˆ¥æ­¸å±¬æ–¼ <code>gateway</code>ã€<code>backend</code>ã€<code>ops</code> é€™ä¸‰å€‹ç¶²æ®µã€‚æ‰€ä»¥éœ€è¦é€²è¡Œä»¥ä¸‹çš„å‹•ä½œã€‚</p><p>é¦–å…ˆï¼Œæ‰‹å‹•å»ºç«‹ä½¿ç”¨çš„ network</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker network create ops
</span></span><span style=display:flex><span>docker network create backend
</span></span><span style=display:flex><span>docker network create gateway
</span></span></code></pre></div><p>æ¥è‘—ï¼Œåœ¨ <code>docker compose</code> ä½¿ç”¨çš„ <code>*.yml</code> å…§ï¼ŒæŒ‡å®šä½¿ç”¨çš„ç¶²è·¯ä¸‹æ–¹ï¼ŒåŠ å…¥ <code>external: true</code> æŒ‡ç¤ºï¼Œdocker compose å°±ä¸æœƒè‡ªå»ºç¶²å€ï¼Œè€Œæ˜¯ä½¿ç”¨å¤–éƒ¨å·²å­˜åœ¨ç¶²è·¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>network</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>my-network</span>:
</span></span><span style=display:flex><span>		<span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><h4 id=a-web-gateway-ä½œç‚ºç«™å°èˆ‡å…¥å£çš„-gateway-è¨­å®š>A. Web-Gateway: ä½œç‚ºç«™å°èˆ‡å…¥å£çš„ gateway è¨­å®š</h4><p>ä½¿ç”¨ Nginx ä½œç‚ºåå‘ä»£ç†ï¼Œä¸¦è¨­å®š <code>nginx.conf</code>ï¼Œè®“æ‰€æœ‰çš„è«‹æ±‚ä¾ Domain èˆ‡è·¯å¾‘ï¼ŒæŒ‡å‘ Astro/Vue å»ºç«‹çš„éœæ…‹ç¶²ç«™ï¼Œæˆ–æ˜¯ WebAPI æœå‹™ã€‚</p><p>è‹¥æ˜¯å° Nginx çµ„æ…‹ä¸ç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Digital Ocean æä¾›çš„ NGINX Conig è¨­å®šå·¥å…· (<a href="https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhTW">NGINXConfig</a>) æˆ– ChatGPT/Claude.ai ä¾†å”åŠ©è¨­å®šã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>web</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>registry.gitlab.com/url-insight/url-insight/web:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>80</span>:<span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx.conf:/etc/nginx/nginx.conf:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      -  <span style=color:#ae81ff>gateway-web</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>gateway</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>yaml æª”å…§ä½¿ç”¨çš„ <code>url-insight/web</code> æ˜¯ä»¥ Nginx ç‚ºåŸºåº•ï¼Œå°‡ Astro/Vue çš„éœæ…‹ç«™å°ä¸€ä½µå°è£ã€‚</p><p>é‡é»åœ¨æ–¼ Mount <code>nginx.conf</code> è¨­å®šèˆ‡æŒ‡å®šä½¿ç”¨å¤–éƒ¨å·²å»ºç«‹çš„ç¶²è·¯ <code>gateway</code>ã€‚</p><h4 id=b-backend-æä¾›-webapi-æœå‹™>B. Backend: æä¾› Webapi æœå‹™</h4><p>Backend ç¶²æ®µï¼Œä¸»è¦æ˜¯ .NET 7 é–‹ç™¼çš„ Web API(<code>url-insight/api</code>) èˆ‡ PostgreSQL è³‡è¨Šæ‰€åœ¨çš„ç¶²æ®µã€‚</p><p>è€Œ yaml æª”å…§çš„é—œæ³¨é»å¦‚ä¸‹ã€‚</p><ul><li>ä½¿ç”¨ <code>expose</code> ä¾†å®£å‘Š container å¯ä½¿ç”¨çš„ port, æä¾›åŒ docker-network çš„å…¶ä»– container é€£å…¥ã€‚ä½†ç„¡æ³•å¾å¤–é¢é€£å…¥ Containerã€‚</li><li>webapi æœå‹™ï¼ŒåŒæ™‚èº«è™• 3 å€‹ docker-networkï¼Œå…¶ç›®çš„èˆ‡ Container é–“çš„è³‡è¨Šå‚³è¼¸èˆ‡ DNS è§£æç›¸é—œã€‚</li></ul><p>é †å¸¶ä¸€æï¼Œè‹¥ Container å…§çš„æ‡‰ç”¨ç¨‹å¼ï¼Œè‹¥æ˜¯æƒ³è¦é€£åˆ°å…¶ä»–çš„ Container, å»ºè­°å»ºç«‹ docker-networkï¼Œå†é…åˆ docker DNS è§£æï¼Œç°¡å–®å¿«é€Ÿçš„é”æˆç›®çš„ã€‚</p><p>åœ¨ä¸‹è¿°çš„ yaml æª”å•Ÿå‹•çš„æœå‹™ï¼Œåœ¨ webapi container å…§çš„ç¨‹å¼ï¼Œå¯ä»¥é€é <code>postgres:5432</code> çš„è¨­å®šï¼Œé †åˆ©è¨ªå•è³‡æ–™åº«ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>webapi</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>registry.gitlab.com/url-insight/url-insight/api:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>expose</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ASPNETCORE_ENVIRONMENT=Production</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ConnectionStrings:${DB_ConnctionString}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>backend</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>gateway</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ops</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:16</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRES_USER=${PSG_USER}$</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRES_PASSWORD=${PSG_PWD}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>expose</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres-data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>backend</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres-data</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>gateway</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ops</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><blockquote><p>ğŸ“¢ é¡Œå¤–è©±</p><p>åœ¨ Linux åœ¨æŒ‡å®šé€£ç·šå­—ä¸²æ™‚ï¼Œå‹™å¿…å¤§å°å¯«ç›¸åŒã€‚å› ç‚ºå€‹äººç¿’æ…£åœ¨ windows ä¸Šé–‹ç™¼ï¼Œæ²’æ³¨æ„åˆ°é€™å€‹ç´°ç¯€ã€‚
åœ¨ä½ˆç½®åœ¨ Ubuntu èˆ‡åŸ·è¡Œ Containerï¼ŒèŠ±äº†ä¸€äº›æ™‚é–“åœ¨æ’é™¤é€™å€‹å•é¡Œã€‚</p></blockquote><h4 id=c-ops-ç”¨æ–¼æ”¶é›†èˆ‡ç›£æ§ç³»çµ±è³‡è¨Š>C. Ops: ç”¨æ–¼æ”¶é›†èˆ‡ç›£æ§ç³»çµ±è³‡è¨Š</h4><p>Ops ç¶²æ®µï¼Œä¸»è¦æ˜¯è² è²¬ç®¡ç†æ‰€æœ‰èˆ‡ç¶­é‹ç›¸é—œæœå‹™çš„ç¶²è·¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>grafana-ops</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>loki</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>grafana/loki:2.9.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3100:3100&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: -<span style=color:#ae81ff>config.file=/etc/loki/local-config.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>grafana</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>grafana</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>GF_PATHS_PROVISIONING=/etc/grafana/provisioning</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>GF_AUTH_ANONYMOUS_ENABLED=true</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>GF_AUTH_ANONYMOUS_ORG_ROLE=Admin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>entrypoint</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sh</span>
</span></span><span style=display:flex><span>      - -<span style=color:#ae81ff>euc</span>
</span></span><span style=display:flex><span>      - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        mkdir -p /etc/grafana/provisioning/datasources
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cat &lt;&lt;EOF &gt; /etc/grafana/provisioning/datasources/ds.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        apiVersion: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        datasources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - name: Loki
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          type: loki
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          access: proxy
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          orgId: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          url: http://loki:3100
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          basicAuth: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          isDefault: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          version: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          editable: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        /run.sh</span>        
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>grafana/grafana:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>grafana</span>
</span></span></code></pre></div><p>ä½†å› ç‚ºåœ¨è¦åŠƒæ™‚ï¼Œä¸å¸Œæœ›å°å¤–é–‹æ”¾æ–¼ Internetï¼Œä½†åˆéœ€è¦è®“ç¶­é‹äººå“¡å¯ä»¥è—‰ç”± Grafana ä¾†æŸ¥çœ‹ç›®å‰ç³»çµ±ç‹€æ…‹ã€‚</p><p>æ‰€ä»¥ä½¿ç”¨ SSH Tunnel çš„æ–¹å¼ï¼Œè®“ç¶­é‹äººå“¡å¯ä»¥ç›´æ¥æŸ¥çœ‹ Grafanaã€‚</p><p>ç°¡å–®é™„ä¸Šä½¿ç”¨çš„èªæ³•ï¼Œè‹¥è¦è©³ç´°ç”¨æ³•ï¼Œå¯åƒè€ƒè£œå……è³‡æ–™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh -L &lt;-port&gt;:&lt;remote-host&gt;:&lt;remote-port&gt; &lt;user&gt;@&lt;remote-host&gt;
</span></span></code></pre></div><h2 id=è£œå……è³‡æ–™>è£œå……è³‡æ–™</h2><p>â–¶ ç«™å…§æ–‡ç« </p><p>â–¶ å¤–éƒ¨æ–‡ç« </p><ul><li><a href=https://philipzheng.gitbook.io/docker_practice/install/ubuntu>Ubuntu - ã€ŠDocker â€”â€” å¾å…¥é–€åˆ°å¯¦è¸ Â­ã€‹æ­£é«”ä¸­æ–‡ç‰ˆ</a></li><li><a href=https://footmark.com.tw/news/linux/ubuntu/ubuntu-server-ufw/>Ubuntu Server 20.04.1 é è¨­ UFW é˜²ç«ç‰† Firewall è¨­å®šè¦å‰‡è©³è§£å’Œæ•™å­¸</a></li><li><a href=https://yu-jack.github.io/2019/01/08/ssh-tunnel/>é—œæ–¼ SSH Tunnel é€£ç·š (SSH Proxy, SSH Port Forwarding) - æŠ€è¡“é›œè¨˜ Technology Notes - Jack Yu | å‚‘å…‹</a></li><li><a href=https://johnliu55.tw/ssh-tunnel.html>SSH Tunneling (Port Forwarding) è©³è§£ Â· John Engineering Stuff</a></li><li><a href=https://www.tecmint.com/ssh-permission-denied-publickey/>How to Fix SSH Permission Denied (Public key) Error</a></li></ul><p>â–¶ åƒè€ƒé€£çµ</p><ul><li><a href=https://terryl.in/zh/best-pricing-vps/>2023 VPS ä¸»æ©Ÿåƒ¹æ ¼è©•æ¯”ï¼šLinode, Vultr, DigitalOcean, OVH - TerryL</a></li><li><a href=https://progressbar.tw/posts/131>å­¸ç¿’ VPS çš„é‡è¦æ€§èˆ‡å„å¤§ Linux VPS æ¯”è¼ƒèˆ‡æ¨è–¦ (Linode, DigitalOcean, Vultr, AWS Lightsail)</a></li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><a class=tag href=/tags/docker/ rel=tag>Docker</a>
<a class=tag href=/tags/postgresql/ rel=tag>Postgresql</a>
<a class=tag href=/tags/grafana/ rel=tag>grafana</a>
<a class=tag href=/tags/ubuntu/ rel=tag>Ubuntu</a></ul></div></footer><hr><div><p>æ–‡ç« å…§å®¹å‡ç‚ºå€‹äººå­¸ç¿’è¨˜éŒ„ã€å¿ƒå¾—èˆ‡èªçŸ¥ï¼Œè‹¥ä»»ä½•è¬¬èª¤æˆ–å»ºè­°ï¼Œæ­¡è¿ç›´æ¥ç•™è¨€è¨è«–ï¼Œä¸€åŒæˆé•·ã€‚</p></div><iframe class=LikeCoin src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feandev.com%2fpost%2fseries%2fside-project%2fshorten-1-build-service-base-on-container%2f" height=200 width=100% frameborder=0></iframe>
<script src=/js/copy-code-clipboard.min.js></script></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/develop/ef-core-cli-note/ rel=prev><span class=pager__subtitle>Â«&#8201;Previous</span><p class=pager__title>EF Core | CLI Tools æ“ä½œç­†è¨˜</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//eanblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 ä¼Šæ©è»Ÿé«”æŠ€è¡“å­¸ç¿’èˆ‡åˆ†äº«.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div></body></html>