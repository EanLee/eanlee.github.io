<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>部署新境界 - 使用 Container 簡化流程 - 伊恩的開發狂想</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7903108559996033" crossorigin=anonymous></script><meta name=description content="從零開始建立自動化發佈的流水線的系列文中，開始進入 Container 的概念討論。"><meta property="og:title" content="部署新境界 - 使用 Container 簡化流程"><meta property="og:description" content="從零開始建立自動化發佈的流水線的系列文中，開始進入 Container 的概念討論。"><meta property="og:type" content="article"><meta property="og:url" content="https://eandev.com/post/series/build-automated-deploy/container-intro/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-08-19T22:15:18+08:00"><meta property="article:modified_time" content="2023-06-28T11:33:14+08:00"><meta itemprop=name content="部署新境界 - 使用 Container 簡化流程"><meta itemprop=description content="從零開始建立自動化發佈的流水線的系列文中，開始進入 Container 的概念討論。"><meta itemprop=datePublished content="2022-08-19T22:15:18+08:00"><meta itemprop=dateModified content="2023-06-28T11:33:14+08:00"><meta itemprop=wordCount content="547"><meta itemprop=keywords content="Docker,"><meta name=twitter:card content="summary"><meta name=twitter:title content="部署新境界 - 使用 Container 簡化流程"><meta name=twitter:description content="從零開始建立自動化發佈的流水線的系列文中，開始進入 Container 的概念討論。"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4HXSCXTZKZ",{anonymize_ip:!1})}</script><link href=/css/syntax.min.css rel=stylesheet><link href=/css/copy-to-clipboard.min.css rel=stylesheet></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class="logo logo--mixed"><a class=logo__link href=/ title=伊恩的開發狂想 rel=home><div class="logo__item logo__imagebox"><img class=logo__img alt=logo src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>伊恩的開發狂想</div><div class=logo__tagline>在知識大海中漂流的小船，不停追尋屬於自己的秘寶。專注於 .NET、雲端技術、系統架構、開發技巧的道、法、術。</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>部署新境界 - 使用 Container 簡化流程</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>伊恩</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-08-19T22:15:18+08:00>2022-08-19</time>
<time class=meta__text datetime=2023-06-28T11:33:14+08:00>(Last Modified: 2023-06-28)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/container/ rel=category>container</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#containers-vs-virtual-machine>Containers vs Virtual Machine</a></li><li><a href=#docker-簡介>Docker 簡介</a></li><li><a href=#安裝-docker-for-windows>安裝 Docker for Windows</a></li><li><a href=#延伸閱讀>延伸閱讀</a><ul><li><a href=#container-與-vm-的差異>Container 與 VM 的差異</a></li><li><a href=#docker>Docker</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><blockquote><p><a href=https://ithelp.ithome.com.tw/users/20107551/ironman/1906>2019 iT 邦幫忙鐵人賽</a>文章補完計劃，<a href=https://eandev.com/post/series/build-automated-deploy/build-ci-cd-from-scratch/#container>從零開始建立自動化發佈的流水線</a> Container 篇</p></blockquote><p>當系統需要重新建置後，會發現建置的過程與步驟煩雜，甚至每次安裝都會發生不同的問題，不管使用虛擬機或是實體機。</p><p>此時，可以視實際情況，考慮使用 Container 的技術，減少環境建置的複雜性與成本。</p><h2 id=containers-vs-virtual-machine>Containers vs Virtual Machine</h2><pre tabindex=0><code class=language-chat data-lang=chat>從建立起 CI/CD 環境後，幫吉米的工作分擔了許多麻煩事。讓吉米有更多的時間去爭取新的專案的情況下。
吉米成立了自己的小公司，並邀請 Eric 作為技術上的顧問。
就這樣過了一兩年，這天，吉米與 Eric 吃飯時，討論起到到客戶那邊更新服務時，種種的情況與問題。

吉米:
  現在的案子，每次更版，至少都要更新兩三支以上的程式，每次都要重新設定真的有點花費太多的時間在這上面。

Eric:
  嗯嗯，最近的案子，程式都是安裝在客戶建立的虛擬機 (Virtual Machine, VM) 中，每次都要重複進行相同的設定。在這情況下，我覺得可以嘗試將容器(Container)技術導入產品之中。

吉米:
  容器技術？是指近年來很紅的 Docker 或 K8S 嗎？這適合我們使用嗎？

Eric:
  嗯，我分析給你聽。
</code></pre><p><figure><center><img src=https://www.backblaze.com/blog/wp-content/uploads/2018/06/whats-the-diff-container-vs-vm.jpg alt="What&amp;rsquo;s the Diff: Containers vs VMs"><figcaption>What&amp;rsquo;s the Diff: Containers vs VMs</figcaption></center></figure></p><p>(圖片來源: <a href=https://www.backblaze.com/blog/vm-vs-containers/>What’s the Diff: VMs vs Containers</a>)</p><p>在討論容器化技術之前，要先了解到底 <strong>容器(Container)</strong> 與 <strong>虛擬機器(Virtual Machine, VM)</strong> 兩者之間的差異到底在那。</p><p>雖然 Container 與 Virtual Machine 都是基於作業系統 (Operating System, OS) 的高階虛擬化的技術，但是兩者的架構與完全不一樣。而原本的作業系統，又稱為主要作業系統 (Host OS)。</p><ul><li><p>Vitual Machine</p><p>Virtual Machine 是從 <strong>作業系統</strong> 下手，它的目標就是 <strong>建立一個可以執行完整作業系統的獨立環境</strong>。</p><p>說到這，就不得不提到 <strong>Hypervisor</strong>，它又稱為虛擬機器監視器 (Virtual Machine Monitor, VMM)，是 Guest OS 與實體機器(physical hardware)的中間層。</p><p>一方面，以軟體的方式，模擬硬體環境替代實體機器，提供適當的 CPU、記憶體、硬碟容量……等虛擬硬體資源給 OS 使用。</p><p>另一方面，負責協調不同虛擬硬體之間對實體機器的操作，以達到多個 OS 與應用程式共用同一套實體機器的資源。例如 VMware vSphere 或 Microsoft Hyper-V 就是 Hypervisor。</p><p>可以想成，Hypervisor 就是硬體提供商，它單純只提供硬體。因此，需要安裝作業系統，才能執行應用程式。而安裝在 Hypervisor 上的 OS，又稱為 Guest OS。</p></li><li><p>Container</p><p>Container 則是直接針對 <strong>應用程式層</strong> 下手，一方面將 <strong>應用程式本身與相關的函式庫、環境配置檔，打包成映像檔 (Image)</strong>，以達到應用程式的獨立與模組化。</p><p>另一方面，藉由 OS 層的抽象化，經由 <strong>Containers Daemon</strong> 的支援，讓每一個 Container 都是獨立環境的前提下，共用 Host OS。這種架構，讓 Container 可運行在實體機、虛擬器，或是雲端基礎設施 (cloud infrastructure)。</p><p>因為 Container 共用 Host OS，所以不像 VM，需要等待 Guest OS 的啟動時間。自然 Container 的啟動時間遠快於 VM。</p></li></ul><p>🔔 題外話 🔔</p><p>Container 技術最早是被發佈與運用在 Linux 之中，經過 Docker 的推廣，才讓 Container 真正的大紅，因此早期僅支援 Linux 環境。</p><p>若要在 Windows 之中使用，只能透過 Virtaul Machine 安裝 Linux Kernel 才能使用，造成 container 在 Windows 的環境下，效能表現不佳，讓許多基於 Windows 的軟體開發商避而不用。</p><p>雖然 Microsoft 先是推出 Windows Subsystem for Linux (WSL)，提供 Linux 的程式於 Windows 上使用，但依然有所局限。</p><p>在 2017 年 Linux Container on Windows (LCOW) 與 Windows Container on Linux (WCOL) 的推出，更是消弭了 Windows 與 Linux 之間的那道牆。</p><p>在 2020 年 9 月 Microsoft 調整 WSL 的架構，推出 WSL2，讓完整的 Linux 核心跑在 Hyper-V 的虛擬機器，提供更貼近原生 Linux 的使用體驗。</p><pre tabindex=0><code class=language-chat data-lang=chat>吉米:
  聽起來，Container 的導入，確實有一定的幫助。但要怎麼做呢？

Eric:
  建議可以從 Docker 先入手。

吉米:
  為什麼會建議使用 Docker 呢？

Eric:
  一來它的資源多，二來，我們的系統還沒大到需要 K8s。使用 Docker 之前，先來聊聊 Docker 的背景與變化。
</code></pre><h2 id=docker-簡介>Docker 簡介</h2><p>Docker 是 dotCloud 公司於 2013 年推出的開源專案。同年，dotCloud 公司也更名為 Docker 公司。Docker 在滙集眾多開發者的貢獻，與 Linux CoreOS 的大力支持下，很快的將 Docker 技術推展開來。</p><p>但是 2017 年 4 月，Docker 公司將原本開源的 Docker 專案名稱更改為 Moby。並將過去集合眾多開發者心血的 Docker，明確的區分為 <strong>企業版 ( Docker Enterprice Edition, Docker EE)</strong> 與 <strong>社群版 (Dockert Community Edition, Docker CE)</strong> 。</p><p>另一方面，Docker 為了支援不同平台，所以針對各同平台，開發各自的 Container Deamon (在 Docker 中，被稱為 Docker Engine)。但這種作法，會導制支援平臺越多，維護的版本就越多的情況。</p><p>所以 Docker 併購了 Unikernel Systems 這個團隊，掌握了自行設計 Hypervisor 和 Unikernel 作業系統的技術。最終，產出 LinuxKit 這個 Linix 子系統。</p><p>在 LinuxKit 的支援下，達成 Docker Engine 的統一化。這讓 Docker 走出 Linux 環境的限制，讓 Docker 可以在更多平台上活躍。</p><p><figure><center><img src=images/docker-layers.png alt="docker layers"><figcaption>docker layers</figcaption></center></figure>(圖片來源: <a href=https://blog.risingstack.com/operating-system-containers-vs-application-containers/>Operating System Containers vs. Application Containers</a>)</p><p>➽ Docker Image</p><p>Docker Image 是 Docker 利用 dockerfile 內的指令堆疊組合而成。每一條指令代表一個 <strong>唯讀層 (Read-only layer)</strong>，且每層的內容必為前面的增量。如上圖的 emacs、Apache。</p><p>換句話說，當基於特定的 Base Image，搭配不同環境或應用程式的需求，將其堆疊組合，最後會產生符合需求的 <strong>唯讀 (Read-only)</strong> Docker Image。</p><p>實務上，可以依需求，決定是將每一個應用程式都打包為單獨的 Image，或是將多個應用程式打包成一個 Image。</p><p>➽ Docker Container</p><p>當運行 Docker Image 時，Docker 會依據 Image 內的資訊，配置可供寫入與使用的資源空間，產生名為 Container 的單獨個體。因此，Image 可以重覆創建 Container。</p><p>➽ Docker Hub</p><p>但每個環境，都要重頭建立需要的 Docker Image，豈不是重複做工嗎？</p><p>Docker 提供一個名為 Docker Hub 的 Remote Repositories，讓所有 Docker 的使用者可能下載現成的 Image。也可以將自己建立的 image 上傳給其他人使用。</p><p>使用者只要註冊 docker 的免費帳戶後，就能從 Docker Hub 下載 Image。同時，免費帳戶也可以將自己建立的 image 上傳到 Public Repositories。若被其他使用者下載，需升級為付費帳戶，才能使用 Private Repositories。</p><p>➽ Docker Compose</p><p>當 Container 越來越多時，利用 Docker compose，就可以方便的管理許多 Container。利用 <code>docker-compose.yml</code> 這個檔案，就可以依不同的需求，個別定義與管理所有 Container 的設定。</p><pre tabindex=0><code class=language-plan data-lang=plan>Eric:
  現在對 Docker 相關的名詞有比較清楚的認識後，接下來，就是實際操作了。

吉米:
  哈哈！那就來吧。

Eric:
  介紹完 Docker 的背景與相關名詞後，直接進入主題吧。

吉米:
  是啊，先教我一下 Docker 的基本操作方式。

Eric:
  沒問題，我們先來安裝 Docker 吧。
</code></pre><h2 id=安裝-docker-for-windows>安裝 Docker for Windows</h2><p>由於 Docker 政策的因素，是無法直接在 Docker 官網下載 Docker CE。必需經過 Docker store，才能下載 Docker CE 。</p><p>Docker Store 必需登入帳戶，才能進行下載動作。如果沒有帳戶，記得申請帳戶。</p><p><figure><center><img src=images/docker_office_web.jpeg alt="Docker 官網"><figcaption>Docker 官網</figcaption></center></figure></p><p>安裝時，不用額外設定，只要順著指示步驟進行安裝，就能完成設定。</p><p>要注意的是，如果準備安裝 Docker for Windows 的作業系統，不是 <strong>Windows 10 Pro</strong> 、 <strong>Enterprise</strong> 、<strong>Windows Server 2016</strong>，會出現以下的畫面，然後就停止安裝動作。</p><p><figure><center><img src=images/docker_cannot_install.png alt="無法安裝 Docker for windows"><figcaption>無法安裝 Docker for windows</figcaption></center></figure></p><p>但是，要補充一點，在 Docker 完裝完成後，假若機器是第一次安裝 Docker，會出現 <code>close and log out</code> 的按鈕：反之，只會出現 <code>close</code> 的按鈕。</p><p>當啟用 Docker for Windows 時，Docker 會自行確認所需的技術或功能是否有開啟支援。若未開啟相關功能，Docker 會詢問是否要開啟。同意的話，會自動重新開機。反之，則直接告知無法啟動 Docker。</p><p><figure><center><img src=images/startup-hyper-V.png alt="啟用 Hyper-V"><figcaption>啟用 Hyper-V</figcaption></center></figure></p><p><del>在啟動後，Docker 會要求使用者登入。</del></p><p><strong>[2022.08 補充] 目前 Docker for Windows version 20.10 之後，不會直接出現使用登入的畫面，改為 Docker Desktop Dashboard 的畫面。</strong></p><p>實際上，登入與否的差異，只差在能否存取 Docker Hub 的 Repositories。本機 Docker 還是可以正常操作。</p><p><figure><center><img src=images/docker_desktop_20.png alt="Docker Dashboard"><figcaption>Docker Dashboard</figcaption></center></figure></p><h2 id=延伸閱讀>延伸閱讀</h2><h3 id=container-與-vm-的差異>Container 與 VM 的差異</h3><ol><li>BACKBLAZE, <a href=https://www.backblaze.com/blog/vm-vs-containers/>What’s the Diff: VMs vs Containers</a></li><li>bmcBlogs, <a href=https://www.bmc.com/blogs/containers-vs-virtual-machines/>Containers vs Virtual Machines: What’s The Difference?</a></li><li>RisingStack, <a href=https://blog.risingstack.com/operating-system-containers-vs-application-containers/>Operating System Containers vs. Application Containers</a></li><li>wiki, <a href=https://zh.wikipedia.org/wiki/Hypervisor>Hypervisor</a></li><li>Microsoft, <a href=https://docs.microsoft.com/zh-tw/windows/wsl/compare-versions>比較 WSL 1 和 WSL 2</a></li></ol><h3 id=docker>Docker</h3><ol><li><a href=http://dockone.io/article/783>10张图带你深入理解Docker容器和镜像</a></li><li><a href=https://docs.docker.com/>Docker Documentatin</a></li><li><a href=https://www.ithome.com.tw/news/113899>【從Docker到Moby】Docker如何將容器平臺變成一門好生意？</a></li><li><a href=https://www.ithome.com.tw/news/113898>【Docker通吃全平臺秘密武器】容器專屬超迷你OS包LinuxKit登場</a></li></ol></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><a class=tag href=/tags/docker/ rel=tag>Docker</a></ul></div></footer><hr><div><p>文章內容均為個人學習記錄、心得與認知，若任何謬誤或建議，歡迎直接留言討論，一同成長。</p></div><iframe class=LikeCoin src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feandev.com%2fpost%2fseries%2fbuild-automated-deploy%2fcontainer-intro%2f" height=200 width=100% frameborder=0></iframe>
<script src=/js/copy-code-clipboard.min.js></script></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/test/%E6%B7%BA%E8%AB%87%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6%E7%9A%84%E6%92%B0%E5%AF%AB/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>淺談單元測試的撰寫</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/devops/gitlab-and-runner-on-same-host-using-docker/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>GitLab CI 實作記錄(1) - 使用 Docker 在同台主機運行 GitLab 與 GitLab-Runner</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//eanblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 伊恩軟體技術學習與分享.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div></body></html>