<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>亂聊壓力測試到底要做什麼? - 伊恩的開發狂想</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="亂聊壓力測試到底要做什麼?"><meta property="og:description" content="摘要
壓力測試必須是有特定目的的前提下去動作的，不同的目的會影響到你的測試做法以及測試系統架構。
壓力測試是將系統效能，加以量化的動作，只有量化才有依據，調整或決定後續的處理方式。無論是增加機器、設定監控警告的水位，或是找出品系統瓶頸加以改善優化，"><meta property="og:type" content="article"><meta property="og:url" content="https://eanlee.github.io/post/test/talking_stress_test/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-04-03T07:30:13+00:00"><meta property="article:modified_time" content="2022-04-03T07:44:11+00:00"><meta itemprop=name content="亂聊壓力測試到底要做什麼?"><meta itemprop=description content="摘要
壓力測試必須是有特定目的的前提下去動作的，不同的目的會影響到你的測試做法以及測試系統架構。
壓力測試是將系統效能，加以量化的動作，只有量化才有依據，調整或決定後續的處理方式。無論是增加機器、設定監控警告的水位，或是找出品系統瓶頸加以改善優化，"><meta itemprop=datePublished content="2022-04-03T07:30:13+00:00"><meta itemprop=dateModified content="2022-04-03T07:44:11+00:00"><meta itemprop=wordCount content="75"><meta itemprop=keywords content="壓力測試,"><meta name=twitter:card content="summary"><meta name=twitter:title content="亂聊壓力測試到底要做什麼?"><meta name=twitter:description content="摘要
壓力測試必須是有特定目的的前提下去動作的，不同的目的會影響到你的測試做法以及測試系統架構。
壓力測試是將系統效能，加以量化的動作，只有量化才有依據，調整或決定後續的處理方式。無論是增加機器、設定監控警告的水位，或是找出品系統瓶頸加以改善優化，"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-4HXSCXTZKZ',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title=伊恩的開發狂想 rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>伊恩的開發狂想</div><div class=logo__tagline>在知識大海中漂流的小船，不停追尋屬於自己的秘寶</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>亂聊壓力測試到底要做什麼?</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>伊恩</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-04-03T07:30:13Z>2022-04-03</time>
<time class=meta__text datetime=2022-04-03T07:44:11Z>(Last Modified: 2022-04-03)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/%E5%A3%93%E5%8A%9B%E6%B8%AC%E8%A9%A6/ rel=category>壓力測試</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#摘要>摘要</a></li><li><a href=#你的目的是什麼>你的目的是什麼?</a><ul><li><a href=#目的一找出單一機器穩定運行系統的最大乘載量>目的一：找出單一機器穩定運行系統的最大乘載量</a></li><li><a href=#目的二找出目前系統運行的瓶頸以進行後續改善與優化>目的二：找出目前系統運行的瓶頸，以進行後續改善與優化</a></li><li><a href=#目的三驗證系統架構可符合需求規格>目的三：驗證系統架構可符合需求規格</a></li></ul></li><li><a href=#測試的對象測試案例的選擇>測試的對象/測試案例的選擇</a></li><li><a href=#簡單總結>簡單總結</a></li></ul></nav></div></div><div class="content post__content clearfix"><h2 id=摘要>摘要</h2><p>壓力測試必須是有特定目的的前提下去動作的，不同的目的會影響到你的測試做法以及測試系統架構。</p><p>壓力測試是將系統效能，加以量化的動作，只有量化才有依據，調整或決定後續的處理方式。無論是增加機器、設定監控警告的水位，或是找出品系統瓶頸加以改善優化，</p><h2 id=你的目的是什麼>你的目的是什麼?</h2><p>今天來聊聊壓力測試到底要做什麼？經常聽到，為了確保軟體系統的穩定度，所以想要藉由壓力測試的方式，進行驗證軟體系統的驗證。(以下將壓力測試簡稱為壓測)</p><p>有趣的是，是有多少人參與壓力測試的人員，清楚知道測試的目的為何?可以得到何種結果？測試的結果會如何使用？要測試到什麼樣的程度，才算完成？</p><p>為了避免在一無所知的情境下，採用無效的壓測方式或過多無用的測試案例。所以在壓力測試前一定要非常明確的了解，壓測的目的為何？我們期望藉由壓測來得到的何種問題的答案？</p><p>隨著你的問題與目的不同，壓力測試所規劃的測試系統架構、測試案例、準備假資料、作法等等，都會有所不同，無法以一概全。</p><h3 id=目的一找出單一機器穩定運行系統的最大乘載量>目的一：找出單一機器穩定運行系統的最大乘載量</h3><p>有時，當需要購買新的機器或在雲端開啟新的機器時，有時會遇到有人會詢問，這台機器可以支援多少人同時使用？多大的流量？機器的規格是否可以符合需求？等等。</p><p>這時使用壓測來量化，目前機器配置的情況所可承載的最大容載量，有時候我們很難去評估目前的機器配置到底可以支撐系統到什麼樣的程度，所以試圖使用壓力測試的方式，將系統在目前機器配置的情況的運行效能加以量化，去找出機器可承受的瓶頸以及最大容載量。</p><p>這個時候所注重的是單一台機器的效能與情況，測試系統架構圖上會盡可能的讓測試的焦點集中在一台機器。同時，系統中的快取機制，資料庫的存取架構(例如讀取分離)等，都會列入評估範圍。</p><p><img src=stress_test_single_test_arch.png alt=單一機器測試架構></p><p>舉例來說，若是今天的測試目的，是想要找出系統在沒有 cache 的情況下，在單一台機器，可承載的請求數量上限為何？同時到達上限後，遇到系統瓶頸時，問題點是發生在軟體本身？資料庫回應逾時？資料庫 I/O 過高？</p><p>此時觀察的不僅僅是請求數量的級別、平均請求響應時間、請求的成功率。此外，也需要觀察受測機器中，CPU 與記憶體的使用率，硬碟 I/O 的存取量。這時候我們才能清楚地去了解，瓶頸發生的位置在哪裡。</p><p>唯有收集完這些相關資訊，針對後續的策略規劃才能有所依據。不管是要擴增機器數量、增加控制的水位值或是系統調整等等。</p><h3 id=目的二找出目前系統運行的瓶頸以進行後續改善與優化>目的二：找出目前系統運行的瓶頸，以進行後續改善與優化</h3><p>當系統運行已經有很長的時間後，有人反應系統效能不佳時，希望對現有系統進行優化。</p><p>在進行系統的改善與優化之前，必須先找出目前軟體遭遇的瓶頸。藉由壓測將系統效能加以量化，同時<strong>收集、統計、分析</strong>壓測過程中的數據資料，試圖找出系統運行間，系統在每個服務之間的轉換、請求響應時間，資料庫的存取耗費時間等等，以便彙整造成瓶頸的問題清單。</p><p>此外，若壓測的情境案例中，處理流程涉及第三方服務，需要考量第三方服務的效能，是否是壓力測試所在意的地方？</p><p>假若想要確認第三方服務的效能，是否是影響系統效能的主要瓶頸點？此時就必須將第三方服務列入測試的範圍內。但要注意的事，若第三方服務屬於外部無法不能控制的類型，需要事前通知第三方服務的供應商，避免造成後續一連串額外的問題。</p><p>假若不是，我們會針對軟體內呼叫第三方服務的部分，使用 Mock 回傳假資料的方式，減少第三方服務對壓測結果的影響。當第三方服務為外部或是部門所不能控制的服務時格外的重要。</p><p>舉例來說，若某個壓測案例中，處理過程中，與 <code>Service 1</code>、<code>Service 2</code>、<code>Service 3</code> 三個第三方服務有所關聯。</p><p><img src=stress_test_3rd_party_process_before.png alt=壓測與第三方服務></p><p>但 <code>Service 1</code>、<code>Service 3</code> 不是此時壓測的考量重點，就會進行<strong>系統內相關區塊的改寫</strong>或是<strong>指向 Mock Service</strong>，減少非必要因素的影響。</p><p><img src=stress_test_3rd_party_process_after.png alt=壓測與第三方服務></p><p>若是壓測的目的，是為系統改善優化，那一定要有一個基準值，基準值不僅僅是規劃優化項目的參考資訊，同時也用來比對優化前後差異。這個基準值可能是上一次壓測的結果資訊，也可能是全新的壓測後收集到的資訊。</p><p>而壓測過程中，最花時間的，莫過於收集、分析系統內流程中各階段所耗費時間、資源。這個部分有很多的方式都可以收集到，可以使用 log 收集，也可以採用 Dump 的方式，或是 Application Insight 監控所收集到的系統資訊等等。</p><p>接著針對這些資料加以統計分析，就會找到我們所最在意的瓶頸問題，這時候我們會針對收集到的瓶頸問題嚴重性加以排序，列出優化的優先順序，因為我們不可能把全部的瓶頸都調教到非常理想的狀態，根據二八法則，只要處理最重要的兩成，就可以得到 80% 的優化結果。</p><h3 id=目的三驗證系統架構可符合需求規格>目的三：驗證系統架構可符合需求規格</h3><p>往往會聽到某某系統可以支援多少人同時上線，或是軟體的需求規格書中，明確要求必須可以支撐多少人同時使用。那麼我們要如何驗證系統是符合要求的呢？</p><p>或者，為了驗證在大量請求的情境下，例如同時 1000 人、2000 人、或 5000 人以上，同時進行交易時，系統所處理的數據資料一切正確。</p><p>藉由壓力測試來驗證大量請求處理的時候，是否符合需求規格書內可承載的最大請求數，或者是用來驗證在龐大交易量的情況下，資料本身是否有發生異常，以確保後續上線之後，重要的資料不會出現異常錯誤。</p><p>若是前者，測試系統架構需要盡可能地貼近實際的系統架構。若是為了驗證資料的正確性，需要額外在初期就規劃好資料驗證的方式。</p><h2 id=測試的對象測試案例的選擇>測試的對象/測試案例的選擇</h2><p>我們常常聽到有人說壓測不可能全部都測試，只要測試最重要的功能就行。</p><p>但可是最重要的功能是什麼？到底要如何麼決定？是工程師決定測試最複雜的部分嗎?還是業務覺得功能最重要？還是想到測什麼就測什麼?
其實這個沒有明確的答案，不同利益關係人的回答都會不一樣。</p><p>我個人的觀點是，在還沒有特定目的和目標之前，從商業情境下手，什麼是最重要的業務情境，那就是最重要的測試情境，接著再針對這個情境下去分析測試方式。</p><p>若是有很明確的測試目的，就直接針對目的進行測試，</p><p>舉例來說，若今天想要測試購物車結帳流程目前的瓶頸點是什麼。那麼我們就不會去考量購物車以外的測試案例，更著重於購物車結帳流程中，各階段的效能、與哪些服務有關係、結帳後的資料驗證等等。</p><h2 id=簡單總結>簡單總結</h2><p>無論基於何種目的去進行壓測，都必須清楚知道壓測的目的與追尋的答案。不同的壓測目的，會影響到測試的案例，測試的架構，是否需要調整程式，都會有所不同。</p><p>壓力測試的目的，說穿了就是對軟體系統目前可支援的層級，以及效能加以數值量化，便於後續評估應對策略。是要加開機器？安排資源，進行系統改善與優化？安排自動化系統監控通知的水位。</p><iframe class=LikeCoin height=235 src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feanlee.github.io%2fpost%2ftest%2ftalking_stress_test%2f" width=100% frameborder=0></iframe></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/%E5%A3%93%E5%8A%9B%E6%B8%AC%E8%A9%A6/ rel=tag>壓力測試</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/software/requirements_clarify/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>軟體開發需求釐清</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/projectmanagement/concepts_of_project_management_from_elimination_games/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>從消除遊戲學到的專案管理二三事</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var t=document,e=t.createElement('script');e.async=!0,e.src='//eanblog.disqus.com/embed.js',e.setAttribute('data-timestamp',+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 伊恩軟體技術學習與分享.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>