<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Docker | ä½¿ç”¨ Docker å»ºç½® ASP.NET Webapi çš„ Image - ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7903108559996033" crossorigin=anonymous></script><meta name=description content="åœ¨ä½¿ç”¨ Docker å°è£æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæœ‰æ™‚å› ç‚ºç¨‹å¼éœ€è¦ä½¿ç”¨ä¸€äº›æ©Ÿæ•æ€§è³‡æ–™ï¼Œä¾‹å¦‚é€£ç·šå­—ä¸²åŠæ†‘è­‰è³‡æ–™ç­‰ï¼Œå°±éœ€è¦é¡å¤–è™•ç†ã€‚åœ¨æ¥ä¸‹ä¾†çš„å…§æ–‡ä¸­ï¼Œä»¥ ASP.NET Webapi ç‚ºä¾‹ï¼Œç°¡è¿°å¦‚ä½•åœ¨ç¢ºä¿ä½¿ç”¨å®¹å™¨æŠ€è¡“çš„åŒæ™‚ï¼Œåˆèƒ½ä¿è­·æ©Ÿå¯†æ€§è³‡æ–™ä¸è¢«å¤–äººæ‰€çŸ¥é“ã€‚"><meta property="og:title" content="Docker | ä½¿ç”¨ Docker å»ºç½® ASP.NET Webapi çš„ Image"><meta property="og:description" content="åœ¨ä½¿ç”¨ Docker å°è£æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæœ‰æ™‚å› ç‚ºç¨‹å¼éœ€è¦ä½¿ç”¨ä¸€äº›æ©Ÿæ•æ€§è³‡æ–™ï¼Œä¾‹å¦‚é€£ç·šå­—ä¸²åŠæ†‘è­‰è³‡æ–™ç­‰ï¼Œå°±éœ€è¦é¡å¤–è™•ç†ã€‚åœ¨æ¥ä¸‹ä¾†çš„å…§æ–‡ä¸­ï¼Œä»¥ ASP.NET Webapi ç‚ºä¾‹ï¼Œç°¡è¿°å¦‚ä½•åœ¨ç¢ºä¿ä½¿ç”¨å®¹å™¨æŠ€è¡“çš„åŒæ™‚ï¼Œåˆèƒ½ä¿è­·æ©Ÿå¯†æ€§è³‡æ–™ä¸è¢«å¤–äººæ‰€çŸ¥é“ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://eandev.com/post/container/aspnet-webapi-containerized/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-02-26T14:18:53+08:00"><meta property="article:modified_time" content="2023-11-11T20:53:23+08:00"><meta itemprop=name content="Docker | ä½¿ç”¨ Docker å»ºç½® ASP.NET Webapi çš„ Image"><meta itemprop=description content="åœ¨ä½¿ç”¨ Docker å°è£æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæœ‰æ™‚å› ç‚ºç¨‹å¼éœ€è¦ä½¿ç”¨ä¸€äº›æ©Ÿæ•æ€§è³‡æ–™ï¼Œä¾‹å¦‚é€£ç·šå­—ä¸²åŠæ†‘è­‰è³‡æ–™ç­‰ï¼Œå°±éœ€è¦é¡å¤–è™•ç†ã€‚åœ¨æ¥ä¸‹ä¾†çš„å…§æ–‡ä¸­ï¼Œä»¥ ASP.NET Webapi ç‚ºä¾‹ï¼Œç°¡è¿°å¦‚ä½•åœ¨ç¢ºä¿ä½¿ç”¨å®¹å™¨æŠ€è¡“çš„åŒæ™‚ï¼Œåˆèƒ½ä¿è­·æ©Ÿå¯†æ€§è³‡æ–™ä¸è¢«å¤–äººæ‰€çŸ¥é“ã€‚"><meta itemprop=datePublished content="2023-02-26T14:18:53+08:00"><meta itemprop=dateModified content="2023-11-11T20:53:23+08:00"><meta itemprop=wordCount content="964"><meta itemprop=keywords content="ASP.NET,Docker,Docker-Network,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker | ä½¿ç”¨ Docker å»ºç½® ASP.NET Webapi çš„ Image"><meta name=twitter:description content="åœ¨ä½¿ç”¨ Docker å°è£æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæœ‰æ™‚å› ç‚ºç¨‹å¼éœ€è¦ä½¿ç”¨ä¸€äº›æ©Ÿæ•æ€§è³‡æ–™ï¼Œä¾‹å¦‚é€£ç·šå­—ä¸²åŠæ†‘è­‰è³‡æ–™ç­‰ï¼Œå°±éœ€è¦é¡å¤–è™•ç†ã€‚åœ¨æ¥ä¸‹ä¾†çš„å…§æ–‡ä¸­ï¼Œä»¥ ASP.NET Webapi ç‚ºä¾‹ï¼Œç°¡è¿°å¦‚ä½•åœ¨ç¢ºä¿ä½¿ç”¨å®¹å™¨æŠ€è¡“çš„åŒæ™‚ï¼Œåˆèƒ½ä¿è­·æ©Ÿå¯†æ€§è³‡æ–™ä¸è¢«å¤–äººæ‰€çŸ¥é“ã€‚"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-4HXSCXTZKZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4HXSCXTZKZ",{anonymize_ip:!1})}</script><link href=/css/syntax.min.css rel=stylesheet><link href=/css/copy-to-clipboard.min.css rel=stylesheet></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class="logo logo--mixed"><a class=logo__link href=/ title=ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³ rel=home><div class="logo__item logo__imagebox"><img class=logo__img alt=logo src=/img/placeholder.png></div><div class="logo__item logo__text"><div class=logo__title>ä¼Šæ©çš„é–‹ç™¼ç‹‚æƒ³</div><div class=logo__tagline>åœ¨çŸ¥è­˜å¤§æµ·ä¸­æ¼‚æµçš„å°èˆ¹ï¼Œä¸åœè¿½å°‹å±¬æ–¼è‡ªå·±çš„ç§˜å¯¶ã€‚å°ˆæ³¨æ–¼ .NETã€é›²ç«¯æŠ€è¡“ã€ç³»çµ±æ¶æ§‹ã€é–‹ç™¼æŠ€å·§çš„é“ã€æ³•ã€è¡“ã€‚</div></div></a></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Docker | ä½¿ç”¨ Docker å»ºç½® ASP.NET Webapi çš„ Image</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>ä¼Šæ©</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-02-26T14:18:53+08:00>2023-02-26</time>
<time class=meta__text datetime=2023-11-11T20:53:23+08:00>(Last Modified: 2023-11-11)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/container/ rel=category>container</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#dockerfile-ç°¡ä»‹>Dockerfile ç°¡ä»‹</a><ul><li><a href=#single-stage-build>Single-Stage Build</a></li><li><a href=#multi-stage-build>Multi-Stage Build</a></li></ul></li><li><a href=#æ©Ÿæ•è³‡æ–™çš„è™•ç†>æ©Ÿæ•è³‡æ–™çš„è™•ç†</a><ul><li><a href=#è³‡æ–™åº«çš„é€£ç·šå­—ä¸²>è³‡æ–™åº«çš„é€£ç·šå­—ä¸²</a></li></ul></li><li><a href=#faq>FAQ</a><ul><li><a href=#ç‚ºä½•-webapi-container-ç„¡æ³•é€£ç·šæœ¬æ©Ÿå¦ä¸€å€‹-container-çš„è³‡æ–™åº«>ç‚ºä½• Webapi Container ç„¡æ³•é€£ç·šæœ¬æ©Ÿå¦ä¸€å€‹ Container çš„è³‡æ–™åº«ï¼Ÿ</a></li></ul></li><li><a href=#å»¶ä¼¸é–±è®€>å»¶ä¼¸é–±è®€</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>æƒ³è¦ä½¿ç”¨ Docker æŠ€è¡“å°‡ ASP.NET Web API æ‡‰ç”¨ç¨‹å¼æ‰“åŒ…æˆ image æ™‚ï¼Œéœ€è¦é‡å°æ©Ÿæ•æ€§è³‡æ–™é€²è¡Œç‰¹åˆ¥çš„è™•ç†ï¼Œä»¥ç¢ºä¿é€™äº›æ©Ÿå¯†æ€§è³‡æ–™ä¸æœƒå¤–æµã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œå°‡ç°¡å–®ä»‹ç´¹ Dockerfile çš„å»ºç½®æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•æä¾›é€£ç·šå­—ä¸²çµ¦ Container å…§çš„æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ã€‚é›–ç„¶å…§æ–‡åªä»‹ç´¹é€£ç·šå­—ä¸²çš„éƒ¨ä»½ï¼Œä½†æ˜¯æ†‘è­‰çš„è™•ç†æ–¹å¼ï¼Œä¹Ÿæ˜¯é¡ä¼¼çš„ä½œæ³•ã€‚</p><blockquote><p>ğŸ”– é•·è©±çŸ­èªª ğŸ”–</p><ul><li>åœ¨ä½¿ç”¨ Docker å°è£æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæœ‰æ™‚éœ€è¦ä½¿ç”¨ä¸€äº›æ©Ÿæ•æ€§è³‡æ–™ï¼Œéœ€è¦é¡å¤–è™•ç†ï¼Œä¾‹å¦‚é€£ç·šå­—ä¸²åŠæ†‘è­‰è³‡æ–™ç­‰ã€‚</li><li>Container çš„æ‰€æœ‰è¨­å®šï¼Œéƒ½å¯ä»¥é€é <code>docker inspect</code> æŒ‡ä»¤æŸ¥çœ‹åˆ°ï¼Œæ‰€ä»¥å‚³éæ©Ÿæ•æ€§è³‡æ–™ï¼Œå¿…é ˆè¦åŠ å¯†æˆ–é€éå…¶ä»–æ–¹å¼ã€‚</li><li>æ©Ÿæ•è³‡æ–™çš„å‚³éï¼Œå¯ä»¥é€é <code>ç’°å¢ƒè®Šæ•¸</code>ã€<code>å‘½ä»¤åˆ—åƒæ•¸</code>èˆ‡ <code>mount/volume</code> çš„æ–¹å¼ã€‚</li><li>Docker Image å»ºç«‹å¾Œï¼Œå¯ä»¥ä½¿ç”¨ <code>docker scan</code> æŒ‡ä»¤ï¼Œé€²è¡Œæƒæï¼Œç¢ºèªæ˜¯å¦æœ‰å®‰å…¨æ€§å•é¡Œã€‚</li></ul></blockquote><p>å¯¦ä½œç’°å¢ƒ</p><ul><li>Windows 10</li><li>.NET 7.0</li><li>Docker Engine 20.10.8</li></ul><h2 id=dockerfile-ç°¡ä»‹>Dockerfile ç°¡ä»‹</h2><p>é›–ç„¶åœ¨ <a href=https://eandev.com/post/series/build-automated-deploy/docker-operate/>Docker æ“ä½œç°¡ä»‹</a> å·²ç¶“æœ‰æéï¼Œä¸éé‚„æ˜¯ç°¡å–®å›é¡§ä¸€ä¸‹ã€‚</p><h3 id=single-stage-build>Single-Stage Build</h3><p>é—œæ–¼ Docker å»ºç½® Image æ™‚ï¼Œæœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯åœ¨ Dockerfile å…§ä¸€å€‹æ­¥é©Ÿå®Œæˆæ‰€æœ‰çš„è¨­å®šï¼Œé€™ç¨®æ–¹å¼ç¨±ç‚º <code>Single-Stage Build</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/sdk:7.0</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /src</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;demo/demo.csproj&#34;</span>, <span style=color:#e6db74>&#34;demo/&#34;</span><span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet restore <span style=color:#e6db74>&#34;demo/demo.csproj&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /src/demo</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet build <span style=color:#e6db74>&#34;demo.csproj&#34;</span> -c Release -o /app/build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet publish <span style=color:#e6db74>&#34;demo.csproj&#34;</span> -c Release -o /app<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 443</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;dotnet&#34;</span>, <span style=color:#e6db74>&#34;demo.dll&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>ç°¡å–®èªªæ˜ä¸€ä¸‹æŒ‡ä»¤çš„æ„ç¾©</p><ul><li><code>FROM</code> ä½¿ç”¨çš„ base Image</li><li><code>WORKDIR</code> ç›®å‰ Image å…§æ‰€åœ¨çš„ä½ç½®</li><li><code>COPY</code> æŠŠå¤–éƒ¨è³‡æ–™è¤‡åˆ¶åˆ° Image å…§çš„æŒ‡å®šä½ç½®</li><li><code>RUN</code> åŸ·è¡ŒæŒ‡å®šçš„æŒ‡ä»¤</li><li><code>EXPOSE</code> æŒ‡å®š Image å…§çš„æœå‹™åŸ </li><li><code>ENTRYPOINT</code> æŒ‡å®š Image å…§çš„åŸ·è¡ŒæŒ‡ä»¤</li></ul><p>ä½†è¦ç‰¹åˆ¥æ³¨æ„ï¼Œè‹¥æ˜¯åœ¨ <code>Single-Stage Build</code> ä¸­ï¼Œç›´æ¥å°‡ç¨‹å¼ç¢¼é€²è¡Œå»ºç½®ã€æ‰“è£çš„æ–¹å¼ï¼Œæœƒå°‡æ‰€æœ‰çš„æ­¥é©Ÿæ‰€ä½¿ç”¨çš„å·¥å…·ã€ä¸­ç¹¼æª”ã€ç¨‹å¼ç¢¼ç­‰ç­‰ï¼Œéƒ½åŒ…å«åœ¨ Image å…§ã€‚</p><p>å°è‡´ Image å…§éƒ¨å­˜åœ¨ä¸å¿…è¦çš„æª”æ¡ˆã€å¤šé¤˜è³‡æ–™ï¼Œé™¤äº†æª”æ¡ˆéå¤§å¤–ï¼Œé‚„å¯èƒ½é€ æˆè³‡æ–™çš„å¤–æ´©ã€‚</p><p>ç•¶ç„¶ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥å»ºç½®éç¨‹ä¸­ï¼ŒåŠ å…¥æŒ‡ä»¤åˆªé™¤å»ºç½®éç¨‹ä¸­ï¼Œæ‰€ä½¿ç”¨çš„ç¨‹å¼ç¢¼èˆ‡ä¸­ç¹¼æª”ï¼Œä¹Ÿåƒ…èƒ½ç¢ºä¿åˆªé™¤çš„é …ç›®ä¸æœƒè¢«ä»–äººçœ‹åˆ°ï¼Œè‡³æ–¼éç¨‹ä¸­ä½¿ç”¨çš„å·¥å…·ç­‰ï¼Œå¯èƒ½é‚„æ˜¯éºç•™åœ¨ Image å…§ã€‚</p><p>Docker çš„ <a href=https://docs.docker.com/build/building/multi-stage/>å®˜æ–¹æ–‡ä»¶</a>ï¼Œä¹Ÿå»ºè­°ä½¿ç”¨ <code>Multi-Stage Build</code> çš„æ–¹å¼ï¼Œä¾†å»ºç½® Imageã€‚é™¤äº†å¯ä»¥æ¸›å°‘ Image çš„å¤§å°å¤–ï¼Œä¹Ÿå¯ä»¥ç¢ºä¿ Image å…§çš„è³‡æ–™ï¼Œä¸æœƒè¢«å¤–æ´©ã€‚</p><h3 id=multi-stage-build>Multi-Stage Build</h3><p>åœ¨ Visual studio å»ºç«‹ .NET å°ˆæ¡ˆæ™‚ï¼Œè‹¥æœ‰å‹¾é¸ support Docker çš„é¸é …ã€‚åœ¨å»ºç«‹å°ˆæ¡ˆçš„åŒæ™‚ï¼Œä¸€ä½µå»ºç«‹ <code>Dockerfile</code> çš„æª”æ¡ˆï¼Œå…¶å…§å®¹çš„ç·¨æ’ï¼Œå°±æ˜¯ä½¿ç”¨ <code>Multi-stage</code> çš„æ–¹å¼ã€‚</p><p>åœ¨é€™å€‹ Dockerfile å…§çš„æè¿°ï¼Œæœƒåˆ†æˆå››å€‹éšæ®µä¾†é€²è¡Œå»ºç½®ã€‚</p><ul><li>é¦–å…ˆï¼Œå»ºç«‹é‹è¡Œç™¼ä½ˆç¨‹å¼æ‰€éœ€è¦çš„ Base Imageã€‚</li><li>å†ä¾†ï¼Œå»ºç«‹å»ºç½®ç’°å¢ƒç”¨çš„å½±åƒæª”ï¼Œè£¡é¢åŒ…å«.NET SDK èˆ‡ ç¨‹å¼ç¢¼ï¼Œä¸¦ç¢ºèªç¨‹å¼ç¢¼å¯ä»¥æ­£å¸¸å»ºç½®ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼Œå°‡ç¬¬äºŒæ­¥å»ºç½®éçš„ç¨‹å¼ç¢¼ï¼Œæ‰“åŒ…æˆç™¼ä½ˆç‰ˆæœ¬ã€‚</li><li>æœ€å¾Œï¼Œå°‡ç™¼ä½ˆç‰ˆæœ¬çš„ç¨‹å¼ï¼Œæ”¾å…¥é‹è¡Œç’°å¢ƒçš„ Base Image å…§ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># å»ºç«‹ä¸€å€‹åŸ·è¡Œç¨‹å¼çš„åŸºç¤æ¨¡æ¿</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/aspnet:7.0 AS base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 443</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ä½¿ç”¨ .NET SDK çš„ Image, ä¸¦ç¨‹å¼ç¢¼è¤‡è£½åˆ°å®¹å™¨å…§ï¼Œä¸¦åŸ·è¡Œå»ºç½®</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/sdk:7.0 AS build</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /src</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;demo/demo.csproj&#34;</span>, <span style=color:#e6db74>&#34;demo/&#34;</span><span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet restore <span style=color:#e6db74>&#34;demo/demo.csproj&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> &#34;/src/demo&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet build <span style=color:#e6db74>&#34;demo.csproj&#34;</span> -c Release -o /app/build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ä½¿ç”¨ä¸Šä¸€æ­¥å»ºç«‹çš„ Image, é€²è¡Œç™¼ä½ˆç‰ˆæœ¬çš„å»ºç½®</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> build AS publish</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet publish <span style=color:#e6db74>&#34;demo.csproj&#34;</span> -c Release -o /app/publish<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># å°‡æœ€å¾Œå»ºç½®çš„ç¨‹å¼ï¼Œæ”¾ç½®åˆ°åŸºç¤çš„ Image å…§ï¼Œä¸¦è¨­å®šåŸ·è¡Œçš„æŒ‡ä»¤</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> base AS final</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>publish /app/publish .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;dotnet&#34;</span>, <span style=color:#e6db74>&#34;demo.dll&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>è‹¥è¦ç¢ºèªæ¯ä¸€å€‹éšæ®µçš„ Image å…§å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker image history</code> æŒ‡ä»¤ï¼Œä¾†æŸ¥çœ‹ã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>docker scan</code> æŒ‡ä»¤ï¼Œä¾†é€²è¡Œæƒæï¼Œç¢ºèªæ˜¯å¦æœ‰å®‰å…¨æ€§çš„å•é¡Œã€‚</p><h2 id=æ©Ÿæ•è³‡æ–™çš„è™•ç†>æ©Ÿæ•è³‡æ–™çš„è™•ç†</h2><p>åœ¨å°ˆæ¡ˆä¸­ï¼Œå¯èƒ½æœƒæœ‰ä¸€äº›æ©Ÿæ•è³‡æ–™ï¼Œä¾‹å¦‚è³‡æ–™åº«çš„é€£ç·šå­—ä¸²ã€æ†‘è­‰è³‡æ–™ç­‰ç­‰ã€‚å¤§ä¼™éƒ½çŸ¥é“ï¼Œé€™äº›è³‡æ–™ä¸æ‡‰è©²ç›´æ¥æ”¾ç½®åœ¨ç¨‹å¼ç¢¼å…§ã€‚ç›¸åŒçš„ï¼Œä¹Ÿä¸æ‡‰è©²æ”¾ç½®åœ¨ Image å…§ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨å¯¦éš›çš„æ‡‰ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨æ†‘è­‰ä¾†é€²è¡Œèº«ä»½é©—è­‰æˆ–è³‡æ–™åŠ å¯†ã€‚é›–ç„¶å¾ŒçºŒæ–‡ç« åªä»‹ç´¹é€£ç·šå­—ä¸²çš„éƒ¨ä»½ï¼Œä½†æ˜¯æ†‘è­‰çš„è™•ç†æ–¹å¼ï¼Œä¹Ÿæ˜¯é¡ä¼¼çš„ä½œæ³•ã€‚</p><p>åœ¨ Docker ä¸­ï¼Œå¯ä»¥é‹ç”¨ <code>mount/volume</code> èˆ‡ <code>ç’°å¢ƒè®Šæ•¸</code> æ–¹å¼ï¼Œæä¾›æ†‘è­‰ã€ç›¸é—œæª”æ¡ˆã€å¯†ç¢¼ï¼Œçµ¦ Container ä½¿ç”¨ã€‚</p><p>è—‰ç”±æ›è¼‰æ–¹å¼ï¼Œå°‡æ†‘è­‰æª”æ¡ˆæ›è¼‰åˆ° container å…§ï¼Œè®“æ‡‰ç”¨ç¨‹å¼å¯ä»¥å­˜å–é€™äº›æª”æ¡ˆï¼Œä¸¦ä¸”é€²è¡Œç›¸é—œçš„æ“ä½œã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥å°‡æ†‘è­‰å¯†ç¢¼ä»¥ç’°å¢ƒè®Šæ•¸çš„å½¢å¼å‚³å…¥ Container ä¸­ï¼Œè®“æ‡‰ç”¨ç¨‹å¼å¯ä»¥é€éé€™äº›ç’°å¢ƒè®Šæ•¸ä¾†å­˜å–æ†‘è­‰è³‡æ–™ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ›è¼‰æ†‘è­‰è³‡æ–™çš„æ–¹å¼éœ€è¦é¡å¤–æ³¨æ„è³‡æ–™çš„å®‰å…¨æ€§ã€‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨åŠ å¯†çš„æ–¹å¼ä¾†ä¿è­·æ†‘è­‰è³‡æ–™çš„å®‰å…¨æ€§ï¼Œä»¥é˜²æ­¢è³‡æ–™è¢«æœªç¶“æˆæ¬Šçš„äººå“¡å­˜å–ã€‚</p><h3 id=è³‡æ–™åº«çš„é€£ç·šå­—ä¸²>è³‡æ–™åº«çš„é€£ç·šå­—ä¸²</h3><p>è‹¥ ASP.NET Webapi å·²ç¶“å»ºç½®ç‚º Docker Imageï¼Œå¯ä»¥ä½¿ç”¨<code>ç’°å¢ƒè®Šæ•¸</code>ã€<code>å‘½ä»¤åˆ—</code>ã€<code>æ›è¼‰æ–‡ä»¶æª”</code> çš„æ–¹å¼ï¼Œä¾†å‚³éè³‡æ–™åº«çš„é€£ç·šè³‡è¨Šã€‚</p><p>æé†’ä¸€ä¸‹ï¼Œ<code>Container</code> å»ºç«‹å¾Œï¼Œæ˜¯å¯ä»¥ç”¨ <code>docker inspect</code> æŸ¥çœ‹ Container çš„ç›¸é—œè¨­å®šï¼Œç„¡è«–æ˜¯ç”¨é‚£ç¨®æ–¹å¼ï¼Œæ©Ÿæ•è³‡æ–™æœ€å¥½é‚„æ˜¯è¦é€²è¡ŒåŠ å¯†ã€‚</p><p>å…ˆæŠŠå·²çŸ¥çš„å„ç¨®åšæ³•çš„å·®ç•°ï¼Œæ•´ç†åˆ—è¡¨å¦‚ä¸‹</p><table><thead><tr><th>ä½œæ³•é¡å‹</th><th>å•Ÿå‹• Container çš„å‹•ä½œ</th><th>Dockfile è¨­å®š</th><th>ç¨‹å¼ç¢¼èª¿æ•´</th></tr></thead><tbody><tr><td>ç’°å¢ƒè®Šæ•¸</td><td>ä½¿ç”¨ <code>-e</code> æŒ‡å®šè³‡æ–™åº«ç›¸é—œè³‡è¨Š</td><td><code>ENV</code></td><td>çµ„æˆé€£ç·šå­—ä¸²ã€åŠ è§£å¯†</td></tr><tr><td>ç’°å¢ƒè®Šæ•¸</td><td>ä½¿ç”¨ <code>-e</code> æŒ‡å®šé€£ç·šå­—ä¸²</td><td><code>ENV</code></td><td>åŠ è§£å¯†</td></tr><tr><td>å‘½ä»¤åˆ—</td><td>ä½¿ç”¨ <code>--</code> å‚³å…¥å‘½ä»¤åˆ—åƒæ•¸</td><td></td><td>å–å¾— Args è³‡æ–™ã€åŠ è§£å¯†</td></tr><tr><td>æ›è¼‰æ–‡ä»¶æª”</td><td>ä½¿ç”¨ <code>-v</code> æ›è¼‰è³‡æ–™å¤¾è·¯å¾‘æˆ– volume</td><td><code>VOLUME</code></td><td>è®€å–ç‰¹å®šä½ç½®çš„æª”æ¡ˆ</td></tr></tbody></table><h4 id=ä½œæ³•ä¸€ç’°å¢ƒè®Šæ•¸>ä½œæ³•ä¸€ã€ç’°å¢ƒè®Šæ•¸</h4><h5 id=è‡ªçµ„é€£ç·šå­—ä¸²>è‡ªçµ„é€£ç·šå­—ä¸²</h5><p>åœ¨ Dockerfile å…§ï¼Œå»ºç«‹å¤šçµ„çš„ç’°å¢ƒè®Šæ•¸ï¼Œå¦‚ <code>Host</code>ã€<code>Port</code>ã€<code>Database</code>ã€<code>User</code>ã€<code>Password</code> ç­‰ã€‚ä¸¦åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œä½¿ç”¨ç’°å¢ƒè®Šæ•¸çš„æ–¹å¼ï¼Œè‡ªè¡Œçµ„åˆç‚ºé€£ç·šå­—ä¸²ã€‚</p><p>ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œå¯¦ä½œçš„æ–¹å¼ã€‚åœ¨ç¨‹å¼ç¢¼çš„éƒ¨ä»½ï¼Œé€£ç·šå­—ä¸²çš„å–å¾—æ–¹å¼ï¼Œæ”¹ç‚ºç”±ç’°å¢ƒè®Šæ•¸è‡ªè¡Œçµ„åˆè€Œæˆã€‚</p><p>å¯¦å‹™ä¸Šï¼Œåœ¨ User èˆ‡ Password çš„éƒ¨ä»½ï¼Œå»ºè­°ç’°å¢ƒè®Šæ•¸çš„è³‡æ–™ï¼Œä½¿ç”¨åŠ å¯†å¾Œçš„å¯†æ–‡ï¼Œé¿å…æ˜æ–‡çš„æ–¹å¼å‚³éã€‚åœ¨çµ„åˆé€£ç·šå­—ä¸²å‰å†è§£å¯†ï¼Œä»¥é¿å…è³‡æ–™å¤–æ´©ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#75715e>// æ©Ÿæ•è³‡æ–™çš„è§£å¯†ã€‚</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨è‡ªè¡Œå¯¦ä½œçš„ Decrypt æ–¹æ³•ä¾†è§£å¯†</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> user = Decrypt(Environment.GetEnvironmentVariable(<span style=color:#e6db74>&#34;DB_USER&#34;</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> password = Decrypt(Environment.GetEnvironmentVariable(<span style=color:#e6db74>&#34;DB_PASSWORD&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä»¥ postgresql çš„é€£ç·šå­—ä¸² ç‚ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> connectionString = <span style=color:#66d9ef>string</span>.Format(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Host={0};Port={1};Database={2};Username={3};Password={4};Pooling=true;&#34;</span>,
</span></span><span style=display:flex><span>    Environment.GetEnvironmentVariable(<span style=color:#e6db74>&#34;DB_HOST&#34;</span>),
</span></span><span style=display:flex><span>    Environment.GetEnvironmentVariable(<span style=color:#e6db74>&#34;DB_PORT&#34;</span>),
</span></span><span style=display:flex><span>    Environment.GetEnvironmentVariable(<span style=color:#e6db74>&#34;DB_NAME&#34;</span>),
</span></span><span style=display:flex><span>    user,
</span></span><span style=display:flex><span>    password);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddDbContext&lt;LabContext&gt;(options =&gt; options.UseNpgsql(connectionString));
</span></span></code></pre></div><p>æ¥è‘—ï¼Œèª¿æ•´ Dockerfile ï¼Œå¢åŠ ç’°å¢ƒè®Šæ•¸ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/aspnet:7.0 AS base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># è¨­å®š DB ç›¸é—œçš„ç’°å¢ƒè®Šæ•¸ï¼Œé€™é‚Šå…ˆçµ¦äºˆé è¨­å€¼</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> DB_HOST<span style=color:#f92672>=</span><span style=color:#ae81ff>127</span>.0.0.1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> DB_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> DB_NAME<span style=color:#f92672>=</span>postgres
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> DB_USER<span style=color:#f92672>=</span>postgres
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> DB_PASSWORD<span style=color:#f92672>=</span><span style=color:#ae81ff>123</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 443</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>// ç•¥ ...<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>åœ¨å®Œæˆä¸Šè¿°çš„èª¿æ•´å¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>docker run</code> çš„æ–¹å¼ï¼Œå•Ÿå‹•å®¹å™¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -e DB_HOST<span style=color:#f92672>=</span>127.0.0.1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -e DB_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -e DB_NAME<span style=color:#f92672>=</span>postgres <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -e DB_USER<span style=color:#f92672>={</span>åŠ å¯†å¾Œçš„ä½¿ç”¨è€…åç¨±<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -e DB_PASSWORD<span style=color:#f92672>={</span>åŠ å¯†å¾Œçš„å¯†ç¢¼<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           -p 5000:80 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>           --name webapi lab/webapi
</span></span></code></pre></div><h5 id=åŠ å¯†å¾Œçš„é€£ç·šå­—ä¸²>åŠ å¯†å¾Œçš„é€£ç·šå­—ä¸²</h5><p>è‹¥æ˜¯è¦ºå¾—å‚³å…¥å¤šå€‹ç’°å¢ƒè®Šæ•¸éæ–¼éº»ç…©ï¼Œä¹Ÿå¯ä»¥æ¡ç”¨ç›´æ¥å‚³å…¥é€£ç·šå­—ä¸²çš„æ–¹å¼ã€‚</p><p>é€™é‚Šï¼Œæˆ‘å€‘å°‡é€£ç·šå­—ä¸²åŠ å¯†ï¼Œä½¿ç”¨ç’°å¢ƒè®Šæ•¸çš„æ–¹å¼ï¼Œå‚³éåŠ å¯†å¾Œçš„å­—ä¸²ï¼Œé€™æ¨£å°±å¯ä»¥é¿å…ç›´æ¥å°‡é€£ç·šå­—ä¸²æ”¾ç½®åœ¨ç¨‹å¼ç¢¼å…§ã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ å¯†å¾Œçš„é€£ç·šå­—ä¸²ï¼Œç„¡æ³•ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œé€²è¡Œè§£å¯†ã€‚è‡³æ–¼é€£ç·šå­—ä¸²çš„åŠ è§£å¯†æ–¹å¼ï¼Œç¶²è·¯ä¸Šå·²ç¶“æœ‰å¾ˆå¤šç¯„ä¾‹ï¼Œé€™é‚Šå°±ä¸å†è´…è¿°ã€‚ä¾‹å¦‚ï¼š<a href=https://blog.darkthread.net/blog/encrypt-ef-connstring/>ç‚ºEFé€£ç·šå­—ä¸²åŠ å¯†çš„ç°¡å–®ç¯„ä¾‹-é»‘æš—åŸ·è¡Œç·’</a>ã€‚</p><p>åŸºæœ¬ä¸Šï¼ŒDockerfile çš„èª¿æ•´æ–¹å¼ï¼Œèˆ‡ä½œæ³•ä¸€ç›¸åŒï¼Œåªæ˜¯åœ¨ç’°å¢ƒè®Šæ•¸çš„è¨­å®šä¸Šï¼Œæ”¹ç‚ºåŠ å¯†å¾Œçš„é€£ç·šå­—ä¸²ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/aspnet:7.0 AS base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># åŠ å…¥ç’°å¢ƒè®Šæ•¸</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> ConnectionStrings<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 443</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>// ç•¥ ...<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#75715e>// é€£ç·šå­—ä¸²çš„è§£å¯†ã€‚</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨è‡ªè¡Œå¯¦ä½œçš„ Decrypt æ–¹æ³•ä¾†è§£å¯†</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> connectionString = Decrypt(Environment.GetEnvironmentVariable(<span style=color:#e6db74>&#34;ConnectionStrings&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddDbContext&lt;LabContext&gt;(options =&gt; options.UseNpgsql(connectionString));
</span></span></code></pre></div><p>åœ¨å®Œæˆä¸Šè¿°çš„èª¿æ•´å¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>docker run</code> çš„æ–¹å¼ï¼Œå•Ÿå‹• Containerã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -p 5000:80 --name webapi -e ConnectionStrings<span style=color:#f92672>={</span>åŠ å¯†å¾Œçš„é€£ç·šå­—ä¸²<span style=color:#f92672>}</span> lab/webapi
</span></span></code></pre></div><h4 id=ä½œæ³•äºŒcommand-argument>ä½œæ³•äºŒã€Command Argument</h4><p>é™¤äº†ä½¿ç”¨ç’°å¢ƒè®Šæ•¸çš„æ–¹å¼ï¼Œ ä¹Ÿå¯ä»¥åœ¨ä¸èª¿æ•´ dockerfile çš„å‰æä¸‹ï¼ŒCommand Argument å‚³éåŠ å¯†å¾Œé€£ç·šå­—ä¸²ã€‚</p><p>åœ¨é€™ä½œå€‹ç°¡å–® Demo ç¯„ä¾‹ï¼Œå…ˆæ–°å¢ä¸€å€‹ ASP.NET Core Webapi å°ˆæ¡ˆï¼Œä¸¦åœ¨ Program.cs ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹çš„ç¨‹å¼ç¢¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>var</span> list = args.ToList();
</span></span><span style=display:flex><span>Log.Information(list.Count &gt; <span style=color:#ae81ff>0</span> ? <span style=color:#66d9ef>string</span>.Join(<span style=color:#e6db74>&#34; &#34;</span>, list) : <span style=color:#e6db74>&#34;No arguments&#34;</span>);
</span></span></code></pre></div><p>ç›´æ¥ä½¿ç”¨ Dockerfile å»ºç½® Imageï¼Œä¸¦é‹è¡Œ Containerã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å»ºç½® Image</span>
</span></span><span style=display:flex><span>docker build . -f Dockerfile -t lab/webapi-args:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‹è¡Œ Container</span>
</span></span><span style=display:flex><span>docker run -p 5000:80 --name webapi lab/webapi-args --ConnectionStrings<span style=color:#f92672>=</span>agnongw8gan99s<span style=color:#f92672>==</span>
</span></span></code></pre></div><p><figure><center><img src=images/docker-multi-stage-build.png alt="Multi-Stage å»ºç½® Image çš„è¨Šæ¯"><figcaption>Multi-Stage å»ºç½® Image çš„è¨Šæ¯</figcaption></center></figure></p><p><figure><center><img src=images/docker-run-args.png alt="å‚³å…¥çš„ Argument ç¢ºå¯¦çš„è¢«ç¨‹å¼å–å¾—"><figcaption>å‚³å…¥çš„ Argument ç¢ºå¯¦çš„è¢«ç¨‹å¼å–å¾—</figcaption></center></figure></p><h4 id=ä½œæ³•ä¸‰æ›è¼‰æ–‡ä»¶æª”>ä½œæ³•ä¸‰ã€æ›è¼‰æ–‡ä»¶æª”</h4><p>ä¸€èˆ¬è€Œè¨€ï¼Œç•¶æˆ‘å€‘ä½¿ç”¨ EF Core ä¾†å»ºç«‹è³‡æ–™åº«çš„é€£ç·šæ™‚ï¼Œé€šå¸¸æœƒå°‡é€£ç·šè³‡è¨Šå­˜æ”¾åœ¨ appsettings.json æª”æ¡ˆä¸­ã€‚</p><p>åŒæ¨£åœ°ï¼Œæˆ‘å€‘å¯ä»¥æ²¿ç”¨é€™ç¨®æ–¹å¼ï¼Œå°‡é€£ç·šè³‡è¨Šå…ˆå­˜æ”¾åœ¨å¦ä¸€å€‹ JSON æª”æ¡ˆä¸­ï¼Œä¸¦å°‡é€™å€‹æª”æ¡ˆæ”¾åœ¨æŒ‡å®šçš„ä¸»æ©Ÿä½ç½®æˆ– Docker Volume å…§ã€‚</p><p>é›–ç„¶åœ¨ç¯„ä¾‹ä¸­ï¼Œç›´æ¥å–å¾—é€£ç·šå­—ä¸²çš„æ˜æ–‡ã€‚ä½†æ˜¯ï¼Œæ­£å¼ç’°å¢ƒï¼Œæœ€å¥½æ˜¯åŠ å¯†å¾Œçš„é€£ç·šå­—ä¸²ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/aspnet:7.0 AS base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># åŠ å…¥ Volume</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>VOLUME</span><span style=color:#e6db74> /app/data</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 443</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>// ç•¥ ...<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#75715e>// å®£å‘Šå­˜æ”¾é€£ç·šå­—ä¸²çš„ connect.json æª”æ¡ˆ</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> configuration = <span style=color:#66d9ef>new</span> ConfigurationBuilder()
</span></span><span style=display:flex><span>                   .SetBasePath(Directory.GetCurrentDirectory())
</span></span><span style=display:flex><span>                   .AddJsonFile(<span style=color:#e6db74>&#34;appsettings.json&#34;</span>)
</span></span><span style=display:flex><span>                   .AddJsonFile(<span style=color:#e6db74>&#34;connect.json&#34;</span>, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>                   .Build();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è®€å–é€£ç·šå­—ä¸²</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> connectionString = builder.Configuration.GetConnectionString(<span style=color:#e6db74>&#34;Lab&#34;</span>);
</span></span><span style=display:flex><span>builder.Services.AddDbContext&lt;LabContext&gt;(options =&gt; options.UseNpgsql(connectionString));
</span></span></code></pre></div><p>è‹¥æ˜¯ç›´æ¥æŠŠ connect.json æ”¾åœ¨å¯¦é«”ä¸»æ©Ÿçš„æŒ‡å®šä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ–¹å¼ï¼Œå°‡æª”æ¡ˆæ›è¼‰åˆ°å®¹å™¨å…§çš„æŒ‡å®šä½ç½®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å‡è¨­ connect.json æ”¾åœ¨ /home/user/connect.json</span>
</span></span><span style=display:flex><span>docker run -d -p 5000:80 --name webapi -v /home/user/:/app/data lab/webapi
</span></span></code></pre></div><p>è‹¥æ˜¯ä½¿ç”¨ Docker Volume çš„æ–¹å¼ï¼Œå°‡æª”æ¡ˆæ›è¼‰åˆ°å®¹å™¨å…§ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ–¹å¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å»ºç«‹ Volume</span>
</span></span><span style=display:flex><span>docker volume create <span style=color:#f92672>{</span>connect-volume<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°‡ connect.json æ”¾å…¥ Volume</span>
</span></span><span style=display:flex><span>docker run -d -v <span style=color:#f92672>{</span>connect-volume<span style=color:#f92672>}</span>:/data -v <span style=color:#f92672>{</span>connect.json æ‰€åœ¨ä½ç½®<span style=color:#f92672>}</span>:/src/ alpine sh -c <span style=color:#e6db74>&#34;cp /src/connect.json /data&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‹è¡Œ Container</span>
</span></span><span style=display:flex><span>docker run -d -p 5000:80 --name webapi -v <span style=color:#f92672>{</span>connect-volume<span style=color:#f92672>}</span>:/app/data lab/webapi
</span></span></code></pre></div><p>å®Œæˆå¾Œï¼Œçš„æ‡‰ç”¨ç¨‹å¼å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ connect.json æª”æ¡ˆå…§çš„é€£ç·šå­—ä¸²ï¼Œä¾†é€£ç·šè³‡æ–™åº«ã€‚</p><p>å…‰èªªä¸ç·´å‡æŠŠå¼ï¼Œæˆ‘å€‘ä½¿ç”¨ä¸‹æ–¹çš„å¹¾è¡ŒæŒ‡ä»¤ä¾†å¿«é€Ÿé©—è­‰ï¼Œæª”æ¡ˆç¢ºå¯¦æœ‰è¢«æ”¾å…¥ <code>VOLUME</code> ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é€²å…¥æª”æ¡ˆæ‰€çš„è³‡æ–™å¤¾</span>
</span></span><span style=display:flex><span>cd c:/Codes/Lab/Demo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å»ºç«‹ Volume</span>
</span></span><span style=display:flex><span>$ docker volume create lab-volume
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç¢ºèª Volume æ˜¯å¦å»ºç«‹æˆåŠŸ</span>
</span></span><span style=display:flex><span>$ docker volume ls --filter <span style=color:#e6db74>&#34;name=lab&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°‡ appsettings.json æ”¾å…¥ Volume</span>
</span></span><span style=display:flex><span><span style=color:#75715e># %cd% ä»£è¡¨ç›®å‰æ‰€åœ¨çš„è³‡æ–™å¤¾, è‹¥æ˜¯ä½¿ç”¨ PowerShell å‰‡æ˜¯ $pwd</span>
</span></span><span style=display:flex><span>$ docker run -v lab-volume:/data -v %cd%:/src alpine sh -c <span style=color:#e6db74>&#34;cp /src/appsettings.json /data&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å•Ÿå‹• Container ä¸¦é€²å…¥</span>
</span></span><span style=display:flex><span>$ docker run -it -v lab-volume:/data alpine
</span></span></code></pre></div><p><figure><center><img src=images/docker-volume-add-file.png alt="å¿«é€Ÿé©—è­‰æª”æ¡ˆåŠ å…¥ Volume çš„æµç¨‹"><figcaption>å¿«é€Ÿé©—è­‰æª”æ¡ˆåŠ å…¥ Volume çš„æµç¨‹</figcaption></center></figure></p><h2 id=faq>FAQ</h2><h3 id=ç‚ºä½•-webapi-container-ç„¡æ³•é€£ç·šæœ¬æ©Ÿå¦ä¸€å€‹-container-çš„è³‡æ–™åº«>ç‚ºä½• Webapi Container ç„¡æ³•é€£ç·šæœ¬æ©Ÿå¦ä¸€å€‹ Container çš„è³‡æ–™åº«ï¼Ÿ</h3><p>åŸå› å¦‚åŒ <a href=../DevOps/GitLab%20CI%20%E5%AF%A6%E4%BD%9C%E8%A8%98%E9%8C%84(1)%20-%20%E4%BD%BF%E7%94%A8%20Docker%20%E5%9C%A8%E5%90%8C%E5%8F%B0%E4%B8%BB%E6%A9%9F%E9%81%8B%E8%A1%8C%20GitLab%20%E8%88%87%20GitLab-Runner.md>GitLab CI å¯¦ä½œè¨˜éŒ„(1) - ä½¿ç”¨ Docker åœ¨åŒå°ä¸»æ©Ÿé‹è¡Œ GitLab èˆ‡ GitLab-Runner</a> ä¸­æåˆ°çš„ Docker Network çš„è§€å¿µå•é¡Œã€‚</p><p>åœ¨åŒä¸€å°ä¸»æ©Ÿä¸Šï¼Œå•Ÿå‹• Container å»ä¸æŒ‡å®š Network çš„æƒ…æ³ä¸‹ï¼Œæœƒä½¿ç”¨åç‚º <code>bridge</code> çš„é è¨­ Networkã€‚</p><p>è€ŒåŠ é è¨­ Network å…§çš„ Container ï¼Œæœƒè¢«è‡ªå‹•åˆ†é…ä¸€å€‹ç¶²æ®µç‚º <code>172.17.0.0/16</code> çš„ IP ä½ç½®ï¼Œæ­¤æ™‚è¦é€£ç·šåˆ°å…¶ä»– Containerï¼Œå¿…é ˆè¦çŸ¥é“å°æ–¹çš„ IP ä½ç½®ã€‚</p><p>é€™æ˜¯å› ç‚ºé è¨­ Network ä¸æ”¯æ´ Docker å…§çš„ DNS åŠŸèƒ½ï¼Œå› æ­¤ç„¡æ³•é€é Container çš„åç¨±ä¾†é€£ç·šã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -e host<span style=color:#f92672>=</span>localhost -p 5001:80 lab/webapi
</span></span></code></pre></div><p>ä¸Šè¿°æŒ‡ä»¤ä¸­ï¼ŒæŒ‡å®š Webapi çš„ container çš„ç’°å¢ƒè®Šæ•¸ <code>host</code> ç‚º <code>localhost</code>ï¼Œä½†å¯¦éš›ä¸Šï¼Œå°æ–¼ Webapi çš„ container ä¾†èªªï¼Œ<code>localhost</code> æ˜¯æŒ‡æ˜¯è‡ªå·±çš„ IP ä½ç½®ï¼Œè€Œéä½¿ç”¨è€…çš„ä¸»æ©Ÿã€‚æ›´ä¸ç”¨èªªè³‡æ–™åº«çš„ container äº†ã€‚</p><p>ç•¶ Webapi çš„ container æŒ‡å®šé€£ç·šçš„ Host ç‚º <code>localhost</code> æ™‚ï¼Œå¯¦éš›ä¸Šæ˜¯é€£ç·šåˆ° Webapi container è‡ªå·±ï¼Œè€Œéè³‡æ–™åº«çš„ containerã€‚</p><p>å°æ­¤ï¼Œæœ‰å…©ç¨®è§£æ±ºæ–¹å¼ï¼š</p><h4 id=è§£æ³•ä¸€ä½¿ç”¨è³‡æ–™åº«çš„-container-çš„-ip-ä½ç½®>è§£æ³•ä¸€ã€ä½¿ç”¨è³‡æ–™åº«çš„ container çš„ IP ä½ç½®</h4><ul><li>ä½¿ç”¨è³‡æ–™åº«çš„ container çš„ IP ä½ç½®ï¼Œè€Œé <code>localhost</code>ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æŸ¥è©¢ Webapi çš„ container çš„ IP ä½ç½®</span>
</span></span><span style=display:flex><span>docker inspect -f <span style=color:#e6db74>&#34;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#34;</span> <span style=color:#f92672>{</span>db_container_name<span style=color:#f92672>}</span>
</span></span></code></pre></div><p><figure><center><img src=images/docker-inspect-network-ip.png alt="ä½¿ç”¨ docker inspect æŸ¥è©¢ container çš„ IP address"><figcaption>ä½¿ç”¨ docker inspect æŸ¥è©¢ container çš„ IP address</figcaption></center></figure></p><h4 id=è§£æ³•äºŒæ–°å¢-network-ä¸¦ä½¿ç”¨-docker-å…§çš„-dns-åŠŸèƒ½>è§£æ³•äºŒã€æ–°å¢ Network ä¸¦ä½¿ç”¨ Docker å…§çš„ DNS åŠŸèƒ½</h4><p>å°‡ Webapi çš„ container èˆ‡è³‡æ–™åº«çš„ container éƒ½åŠ å…¥åˆ°åŒä¸€å€‹ Network å…§ï¼Œä¸¦æŒ‡å®šç›¸åŒçš„ç¶²æ®µï¼Œé€™æ¨£å…©å€‹ Container å°±å¯ä»¥äº’ç›¸é€£ç·šäº†ã€‚</p><p>åªè¦æ‰‹å‹•å¢åŠ ä¸€å€‹é¡å‹ç‚º <code>Bridge</code> çš„ Networkï¼Œå®ƒå°±æœƒè‡ªå‹•æ”¯æ´ Docker å…§çš„ DNS åŠŸèƒ½ã€‚</p><p>ç„¶å¾Œå…ˆæŠŠè³‡æ–™åº«çš„ Container åˆ‡æ›åˆ°æ–°çš„ Network å…§ï¼Œå†å•Ÿå‹• Webapi çš„ Containerï¼Œå°±å¯ä»¥ä½¿ç”¨è³‡æ–™åº«çš„ Container çš„åç¨±ä¾†é€£ç·šäº†ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å»ºç«‹ Network</span>
</span></span><span style=display:flex><span>docker network create --driver bridge <span style=color:#f92672>{</span>network_name<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°‡è³‡æ–™åº«çš„ Container åˆ‡æ›åˆ°æ–°çš„ Network å…§</span>
</span></span><span style=display:flex><span>docker network connect <span style=color:#f92672>{</span>network_name<span style=color:#f92672>}</span> <span style=color:#f92672>{</span>db_container_name<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å•Ÿå‹• Webapi çš„ Container</span>
</span></span><span style=display:flex><span>docker run -d --name -e host<span style=color:#f92672>={</span>db_container_name<span style=color:#f92672>}</span> -e database<span style=color:#f92672>=</span>demo -e user_id<span style=color:#f92672>=</span>test -e password<span style=color:#f92672>=</span>test -p 5001:80 lab/webapi --network <span style=color:#f92672>{</span>network_name<span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=å»¶ä¼¸é–±è®€>å»¶ä¼¸é–±è®€</h2><p>â–¶ ç«™å…§æ–‡ç« </p><ul><li><a href=https://eandev.com/post/series/build-automated-deploy/docker-operate/>Docker æ“ä½œç°¡ä»‹</a></li><li><a href=https://eandev.com/post/develop/dotnet-ef-postgresql-dbcontext/>ä½¿ç”¨ dotnet-ef å»ºç«‹ PostgreSQL çš„ DBContext</a></li><li><a href=https://eandev.com/post/develop/dotnet-ef-sqlserver/>ä½¿ç”¨ dotnet-ef å»ºç«‹ SQL Server on Docker çš„ DBContext</a></li><li><a href=https://eandev.com/post/container/docker-postgresql-initialization-scripts/>å»ºç«‹ PostgreSQL çš„ container æ™‚ï¼ŒåŒæ™‚å®Œæˆè³‡æ–™åº«çš„åˆå§‹åŒ–</a></li></ul><p>â–¶ ç«™å¤–æ–‡ç« </p><ul><li><a href=https://www.connectionstrings.com/>ConnectionStrings.com</a></li><li><a href=https://blog.darkthread.net/blog/encrypt-ef-connstring/>ç‚ºEFé€£ç·šå­—ä¸²åŠ å¯†çš„ç°¡å–®ç¯„ä¾‹-é»‘æš—åŸ·è¡Œç·’</a></li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><a class=tag href=/tags/asp.net/ rel=tag>ASP.NET</a>
<a class=tag href=/tags/docker/ rel=tag>Docker</a>
<a class=tag href=/tags/docker-network/ rel=tag>Docker-Network</a></ul></div></footer><hr><div><p>æ–‡ç« å…§å®¹å‡ç‚ºå€‹äººå­¸ç¿’è¨˜éŒ„ã€å¿ƒå¾—èˆ‡èªçŸ¥ï¼Œè‹¥ä»»ä½•è¬¬èª¤æˆ–å»ºè­°ï¼Œæ­¡è¿ç›´æ¥ç•™è¨€è¨è«–ï¼Œä¸€åŒæˆé•·ã€‚</p></div><iframe class=LikeCoin src="https://button.like.co/in/embed/wosilee/button?referrer=https%3a%2f%2feandev.com%2fpost%2fcontainer%2faspnet-webapi-containerized%2f" height=200 width=100% frameborder=0></iframe>
<script src=/js/copy-code-clipboard.min.js></script></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/container/docker-postgresql-initialization-scripts/ rel=prev><span class=pager__subtitle>Â«&#8201;Previous</span><p class=pager__title>Docker | å»ºç«‹ PostgreSQL çš„ container æ™‚ï¼ŒåŒæ™‚å®Œæˆè³‡æ–™åº«çš„åˆå§‹åŒ–</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/develop/http-response-status-unexpected-note/ rel=next><span class=pager__subtitle>Next&#8201;Â»</span><p class=pager__title>ASP.NET Core | API å›æ‡‰ HTTP Status éé æœŸçš„åŸå› ç­†è¨˜</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//eanblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 ä¼Šæ©è»Ÿé«”æŠ€è¡“å­¸ç¿’èˆ‡åˆ†äº«.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div></body></html>